<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>支付 SDK 说明 | 小天才开放平台 | 文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="小天才开放平台,小天才开发者平台,帮助开发者更好地开发平台应用。">
    
    <link rel="preload" href="static/css/0.styles.3e96b5ae.css" as="style"><link rel="preload" href="https://developer.okii.com/docs/assets/js/app.c5cf0902.js" as="script"><link rel="preload" href="https://developer.okii.com/docs/assets/js/2.64c56ba3.js" as="script"><link rel="preload" href="https://developer.okii.com/docs/assets/js/5.7d14a609.js" as="script"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/10.7dabc864.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/11.a857b413.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/12.b65651e7.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/13.0ec7aaa7.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/14.ae03732c.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/15.bd585f03.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/16.8ce8785d.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/17.83cf954d.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/18.0a544859.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/19.3e8a6e86.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/20.b97b66fb.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/21.e0a445ca.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/22.c6f18896.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/23.bb06cbb4.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/24.3a8f5dc7.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/25.6258f33e.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/26.d995a2f2.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/27.1fadabf2.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/28.0708c0c2.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/29.3ac293a5.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/3.89808b9c.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/30.cd196038.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/31.29284ed9.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/32.6e0fbfcd.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/33.5b4e9fbb.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/34.faf644ab.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/35.d64c3b26.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/36.ffa0bc2d.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/37.4efadb19.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/38.1301eb3d.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/39.765462f8.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/4.40351588.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/40.8ae7b2ef.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/41.b53a935b.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/42.1b8db389.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/43.57d2f36e.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/44.4f42e10b.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/45.49d1f12c.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/46.b00351d5.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/47.ee33eed7.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/48.d593d13f.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/49.90697f7e.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/50.eb9d6e79.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/6.145dd442.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/7.d2b7988b.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/8.63a01d72.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/9.f91da2c8.js">
    <link rel="stylesheet" href="static/css/0.styles.3e96b5ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewbox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="docs.html" class="home-link router-link-active"><!----> <span class="site-name">小天才开放平台 | 文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  回到首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="apply.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  申请入驻
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="contact.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  联系我们
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="en.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  回到首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="apply.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  申请入驻
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="contact.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  联系我们
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="en.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>应用发布</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="01-shelf.html" class="sidebar-link">上架流程</a></li><li><a href="03-version.html" class="sidebar-link">版本提供</a></li><li><a href="02-resource.html" class="sidebar-link">审核规范</a></li><li><a href="06-publish.html" class="sidebar-link">市场监控标准</a></li><li><a href="04-principle.html" class="sidebar-link">应用违规处理（试运行）</a></li><li><a href="05-notice.html" class="sidebar-link">侵权投诉处理流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>开发指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="00-model.html" class="sidebar-link">开放机型</a></li><li><a href="01-setting.html" class="sidebar-link">基础配置</a></li><li><a href="02-permission.html" class="sidebar-link">应用权限</a></li><li><a href="09-account.html" class="sidebar-link">账号系统</a></li><li><a href="08-service.html" class="sidebar-link">应用服务号</a></li><li><a href="" aria-current="page" class="active sidebar-link">支付 SDK 说明</a></li><li><a href="03-function.html" class="sidebar-link">API开放接口</a></li><li><a href="04-optimization.html" class="sidebar-link">注意事项</a></li><li><a href="06-problem.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>设计指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="interaction.html" class="sidebar-link">交互设计</a></li><li><a href="vision.html" class="sidebar-link">视觉设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>快应用接入</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="01-guide.html" class="sidebar-link">快应用接入</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="支付-sdk-说明"><a href="#支付-sdk-说明" class="header-anchor">#</a> 支付 SDK 说明</h1> <p></p><div class="table-of-contents"><ul><li><a href="#一、支付-服务器对接">一、支付-服务器对接</a><ul><li><a href="#_1-1-服务器公共信息">1.1 服务器公共信息</a></li><li><a href="#_1-2-获取校验码">1.2 获取校验码</a></li><li><a href="#_1-3-查询订单状态">1.3 查询订单状态</a></li><li><a href="#_1-4-支付结果回调">1.4 支付结果回调</a></li><li><a href="#_1-5-网页支付预下单">1.5 网页支付预下单</a></li><li><a href="#_1-6-支付问题解答">1.6 支付问题解答</a></li></ul></li><li><a href="#二、手表端扫码支付sdk说明">二、手表端扫码支付SDK说明</a><ul><li><a href="#_2-1-注册开发者账号">2.1 注册开发者账号</a></li><li><a href="#_2-2-流程">2.2 流程</a></li><li><a href="#_2-3-搭建开发环境">2.3 搭建开发环境</a></li><li><a href="#_2-4-表端示例代码">2.4 表端示例代码</a></li><li><a href="#_2-5-获取校验码">2.5 获取校验码</a></li><li><a href="#_2-6-查询订单状态">2.6 查询订单状态</a></li><li><a href="#_2-7-支付结果回调">2.7 支付结果回调</a></li></ul></li><li><a href="#三、小天才app支付sdk说明">三、小天才APP支付SDK说明</a><ul><li><a href="#_3-1-整体流程">3.1 整体流程</a></li><li><a href="#_3-2-获取支付校验码">3.2 获取支付校验码</a></li><li><a href="#_3-3-支付订单">3.3 支付订单</a></li><li><a href="#_3-4-查询订单状态">3.4 查询订单状态</a></li></ul></li><li><a href="#四、网页支付">四、网页支付</a><ul><li><a href="#_4-1-整体流程">4.1 整体流程</a></li><li><a href="#_4-2-整体交互流程图">4.2 整体交互流程图</a></li><li><a href="#_4-3-细节时序图">4.3 细节时序图</a></li><li><a href="#_4-4-获取openid">4.4 获取openId</a></li><li><a href="#_4-5-下单接口">4.5 下单接口</a></li><li><a href="#_4-6-查询订单">4.6 查询订单</a></li><li><a href="#_4-7-金额管控说明">4.7 金额管控说明</a></li></ul></li><li><a href="#五、聚合码支付">五、聚合码支付</a><ul><li><a href="#_5-1-说明">5.1 说明</a></li><li><a href="#_5-2-前提条件">5.2 前提条件</a></li><li><a href="#_5-2-接入流程">5.2 接入流程</a></li><li><a href="#_5-3-金额管控说明">5.3 金额管控说明</a></li></ul></li><li><a href="#六、支付金额管控">六、支付金额管控</a><ul><li><a href="#_6-1-触发条件">6.1 触发条件</a></li></ul></li><li><a href="#七、商品名称命名规范">七、商品名称命名规范</a><ul><li><a href="#_7-1-命名规则及参考">7.1 命名规则及参考</a></li></ul></li><li><a href="#八、售后服务规则">八、售后服务规则</a><ul><li><a href="#_8-1-退款原则">8.1 退款原则</a></li></ul></li></ul></div><p></p> <h2 id="一、支付-服务器对接"><a href="#一、支付-服务器对接" class="header-anchor">#</a> 一、支付-服务器对接</h2> <p>小天才服务端提供的接口。</p> <h3 id="_1-1-服务器公共信息"><a href="#_1-1-服务器公共信息" class="header-anchor">#</a> 1.1 服务器公共信息</h3> <h4 id="_1-1-1-环境说明"><a href="#_1-1-1-环境说明" class="header-anchor">#</a> 1.1.1 环境说明</h4> <ul><li>测试环境域名：https://api-module.okii.com</li> <li>正式环境域名：https://api.watch.okii.com</li></ul> <h4 id="_1-1-2-接入方式"><a href="#_1-1-2-接入方式" class="header-anchor">#</a> 1.1.2 接入方式</h4> <p>如果未做说明，小天才提供的接口均以<strong>HTTP+POST+JSON</strong>方式调用,接口返回的也是 JSON 格式数据</p> <blockquote><p><strong>content-type</strong>为<code>application/json</code>,否则 HTTP Response 会返回<strong>415</strong>状态码</p></blockquote> <h4 id="_1-1-3-接口响应格式"><a href="#_1-1-3-接口响应格式" class="header-anchor">#</a> 1.1.3 接口响应格式</h4> <table><thead><tr><th style="text-align:center;">字段名</th> <th style="text-align:center;">字段含义</th> <th style="text-align:center;">字段类型</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">请求返回状态码</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">desc</td> <td style="text-align:center;">请求返回状态描述</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">返回结果</td> <td style="text-align:center;">Object</td></tr></tbody></table> <p>如：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_1-1-4-服务器错误码"><a href="#_1-1-4-服务器错误码" class="header-anchor">#</a> 1.1.4 服务器错误码</h4> <table><thead><tr><th style="text-align:right;">错误码</th> <th style="text-align:center;">服务器标识</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:right;">000001</td> <td style="text-align:center;">success</td> <td style="text-align:center;">调用成功</td></tr> <tr><td style="text-align:right;">12001</td> <td style="text-align:center;">XTCPAY_INVALID_REQUEST</td> <td style="text-align:center;">参数无效</td></tr> <tr><td style="text-align:right;">12002</td> <td style="text-align:center;">XTCPAY_INVALID_APP</td> <td style="text-align:center;">APP 信息无效</td></tr> <tr><td style="text-align:right;">12003</td> <td style="text-align:center;">XTCPAY_INVALID_PAYCHANNEL</td> <td style="text-align:center;">支付渠道无效</td></tr> <tr><td style="text-align:right;">12004</td> <td style="text-align:center;">XTCPAY_INVALID_PAYMODEL</td> <td style="text-align:center;">支付类型不存在</td></tr> <tr><td style="text-align:right;">12005</td> <td style="text-align:center;">XTCPAY_AMOUNT_NOT_EQUAL</td> <td style="text-align:center;">支付数额不相同</td></tr> <tr><td style="text-align:right;">12006</td> <td style="text-align:center;">XTCPAY_CREATE_ORDER_ERROR</td> <td style="text-align:center;">创建订单失败</td></tr> <tr><td style="text-align:right;">12009</td> <td style="text-align:center;">XTCPAY_INVALID_ORDERID</td> <td style="text-align:center;">订单号不存在</td></tr> <tr><td style="text-align:right;">12010</td> <td style="text-align:center;">XTCPAY_INVALID_USER_ORDER_RELATION</td> <td style="text-align:center;">传参用户和实际用户信息不符，无法获取订单详情</td></tr> <tr><td style="text-align:right;">12011</td> <td style="text-align:center;">XTCPAY_INVALID_ORDER_ITEMORDER_RELATION</td> <td style="text-align:center;">传参订单 ID 和实际订单 ID 不符，无法获取订单详情</td></tr> <tr><td style="text-align:right;">12012</td> <td style="text-align:center;">XTCPAY_PRODUCT_CONTENT_MODIFICATION</td> <td style="text-align:center;">订单 id 没变，但是商品内容有修改</td></tr> <tr><td style="text-align:right;">12013</td> <td style="text-align:center;">XTCPAY_ORDER_PAID</td> <td style="text-align:center;">订单已支付</td></tr> <tr><td style="text-align:right;">12014</td> <td style="text-align:center;">XTCPAY_ORDER_QUERY_ERROR</td> <td style="text-align:center;">订单查询失败</td></tr> <tr><td style="text-align:right;">12015</td> <td style="text-align:center;">XTCPAY_ORDER_NOT_UPDATED</td> <td style="text-align:center;">订单状态未更新</td></tr> <tr><td style="text-align:right;">12016</td> <td style="text-align:center;">XTCPAY_VERIFY_SIGN_ERROR</td> <td style="text-align:center;">签名校验错误</td></tr> <tr><td style="text-align:right;">12020</td> <td style="text-align:center;">XTCPAY_CHECK_CODE_EXPIRE</td> <td style="text-align:center;">校验码过期</td></tr> <tr><td style="text-align:right;">12021</td> <td style="text-align:center;">XTCPAY_CHECK_CODE_INVALID</td> <td style="text-align:center;">校验码错误</td></tr> <tr><td style="text-align:right;">12099</td> <td style="text-align:center;">OTHER_ERROR</td> <td style="text-align:center;">其它错误</td></tr> <tr><td style="text-align:right;">12209</td> <td style="text-align:center;">INVALID_OPEN_ID</td> <td style="text-align:center;">无效的openId（openId不存在或跟appId不对应）</td></tr> <tr><td style="text-align:right;">12207</td> <td style="text-align:center;">XTCPAY_ABNORMAL_ORDER</td> <td style="text-align:center;">订单异常</td></tr> <tr><td style="text-align:right;">12208</td> <td style="text-align:center;">PREPAY_ORDER_FAIL</td> <td style="text-align:center;">预下单失败</td></tr> <tr><td style="text-align:right;">12215</td> <td style="text-align:center;">PAY_CHANNEL_AND_MODEL_NOT_MATCH</td> <td style="text-align:center;">支付渠道与支付类型不匹配</td></tr> <tr><td style="text-align:right;">12216</td> <td style="text-align:center;">order has been refunded</td> <td style="text-align:center;">订单已退款</td></tr></tbody></table> <h4 id="_1-1-5-常用签名算法"><a href="#_1-1-5-常用签名算法" class="header-anchor">#</a> 1.1.5 常用签名算法</h4> <p>Hmac签名算法</p> <h5 id="java版本"><a href="#java版本" class="header-anchor">#</a> <strong>Java版本</strong></h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Mac</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">SecretKeySpec</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">MessageDigest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HmacSignUtils</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">++</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ProductInfo</span> productInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProductInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            productInfo<span class="token punctuation">.</span><span class="token function">setProductId</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            productInfo<span class="token punctuation">.</span><span class="token function">setProductName</span><span class="token punctuation">(</span><span class="token string">&quot;vip&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            productInfo<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;0.01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            productInfo<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>productInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 构建需要参与签名的map</span>
        注意：具体参与签名的字段需要根据接口文档的说明填写，以下的字段只是做一个示例
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;appId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;申请入驻时分配的appId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;nonceStr&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;6dab9b56474d4104b9dfc4c53eb25702&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;orderId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;payModel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;refundOrderId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a14284f2a10f3bcc8679b7af8a1fe91a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;totalFee&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0.02&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;商品标题&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;ip&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;172.28.184.52&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;returnUrl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://www.baidu.com/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果参数是一个对象，请转化成json字符串</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;productInfos&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> signParamStr <span class="token operator">=</span> <span class="token function">createLinkString</span><span class="token punctuation">(</span><span class="token function">paraFilter</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;进行签名的串:&quot;</span> <span class="token operator">+</span> signParamStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 申请入驻时对应应用ID的appSecret</span>
        <span class="token class-name">String</span> appSecret <span class="token operator">=</span> <span class="token string">&quot;申请入驻时分配的appSecrete密钥&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sign <span class="token operator">=</span> <span class="token function">sha256HmacAndMd5</span><span class="token punctuation">(</span>signParamStr<span class="token punctuation">,</span> appSecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;签名sign：&quot;</span> <span class="token operator">+</span> sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createLinkString</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> prestr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> key <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 拼接时，不包括最后一个&amp;字符</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                prestr <span class="token operator">=</span> prestr <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                prestr <span class="token operator">=</span> prestr <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> prestr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">paraFilter</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> paramMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>paramMap <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> paramMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> paramMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> paramMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                    <span class="token operator">||</span> <span class="token string">&quot;sign&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
                    <span class="token operator">||</span> <span class="token string">&quot;sign_type&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">sha256HmacAndMd5</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">String</span> secret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> hash <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Mac</span> sha256Hmac <span class="token operator">=</span> <span class="token class-name">Mac</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;HmacSHA256&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SecretKeySpec</span> secretKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>secret<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;HmacSHA256&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sha256Hmac<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> results <span class="token operator">=</span> sha256Hmac<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 进行MD5处理</span>
            <span class="token class-name">MessageDigest</span> md <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;MD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
            hash <span class="token operator">=</span> <span class="token function">parseByteToHex</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> hash<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 转化为16进制
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">parseByteToHex</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> tmp<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> bytes <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> n <span class="token operator">&lt;</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tmp <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>bytes<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0XFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ProductInfo</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> productId<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> productName<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> price<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> number<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getProductId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> productId<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProductId</span><span class="token punctuation">(</span><span class="token class-name">String</span> productId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>productId <span class="token operator">=</span> productId<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getProductName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> productName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProductName</span><span class="token punctuation">(</span><span class="token class-name">String</span> productName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>productName <span class="token operator">=</span> productName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> price<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span> price<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> number<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">=</span> number<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="php版本"><a href="#php版本" class="header-anchor">#</a> <strong>php版本</strong></h5> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">doSign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function-definition function">doSign</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//  $params=['appId'='123','nonceStr'='123123','orderId'='123123',];</span>
<span class="token comment">// 构建参与签名的集合</span>
注意：实际参与签名的字段以接口文档说明为准，以下字段只是做一个示例的作用。
<span class="token variable">$params</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'appId'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'分配的appId'</span><span class="token punctuation">,</span>  
              <span class="token string single-quoted-string">'nonceStr'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'随机数，建议使用去掉-的uuid，如4d3f32b235e44084abbad04c36559dda'</span><span class="token punctuation">,</span> 
              <span class="token string single-quoted-string">'orderId'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'订单ID'</span><span class="token punctuation">,</span>
              <span class="token comment">// 其他需要参与签名的字段</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$signStr</span><span class="token operator">=</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$params</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sign'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$signStr</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token constant">PHP_EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'签名sign:'</span> <span class="token operator">.</span> <span class="token variable">$signStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-definition function">sign</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">ksort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$prestr</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
    <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">// 拼接加密的字符串</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=&gt;</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// sign、sign_type不参与签名</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sign'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sign_type'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">==</span> <span class="token variable">$count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 拼接时，不包括最后一个&amp;字符</span>
                <span class="token variable">$prestr</span> <span class="token operator">.=</span>  <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'='</span> <span class="token operator">.</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$prestr</span> <span class="token operator">.=</span>  <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'='</span> <span class="token operator">.</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&amp;'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'参与签名字符串:'</span> <span class="token operator">.</span> <span class="token variable">$prestr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">hash_hmac</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sha256'</span><span class="token punctuation">,</span><span class="token variable">$prestr</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'申请入驻时分配的appSecrete'</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-2-获取校验码"><a href="#_1-2-获取校验码" class="header-anchor">#</a> 1.2 获取校验码</h3> <h4 id="_1-2-1-接口地址"><a href="#_1-2-1-接口地址" class="header-anchor">#</a> 1.2.1 接口地址</h4> <p><code>/pay-service/third/checkCode</code></p> <h4 id="_1-2-2-请求参数"><a href="#_1-2-2-请求参数" class="header-anchor">#</a> 1.2.2 请求参数</h4> <table><thead><tr><th style="text-align:center;">字段名</th> <th style="text-align:center;">字段含义</th> <th style="text-align:center;">字段类型</th></tr></thead> <tbody><tr><td style="text-align:center;">appId</td> <td style="text-align:center;">第三方应用注册小天才开放平台时分配的 AppID</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">appSecret</td> <td style="text-align:center;">开放平台 secretId</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">orderId</td> <td style="text-align:center;">第三方订单 id（第三方自己生成，40 个字符长度），请确保唯一，建议用 uuid</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">totalFee</td> <td style="text-align:center;">订单金额</td> <td style="text-align:center;">Number</td></tr></tbody></table> <p>如：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;appId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;appId&quot;</span><span class="token punctuation">,</span> <span class="token comment">//开发平台appId</span>
    <span class="token property">&quot;appSecret&quot;</span><span class="token operator">:</span> <span class="token string">&quot;appSecret&quot;</span><span class="token punctuation">,</span> <span class="token comment">//开发平台appSecret</span>
    <span class="token property">&quot;orderId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;orderId&quot;</span><span class="token punctuation">,</span> <span class="token comment">//第三方订单号</span>
    <span class="token property">&quot;totalFee&quot;</span><span class="token operator">:</span> <span class="token number">110.01</span> <span class="token comment">//订单金额 单位:元,固定2位小数，如30.00</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_1-2-3-响应出参"><a href="#_1-2-3-响应出参" class="header-anchor">#</a> 1.2.3 响应出参</h4> <table><thead><tr><th style="text-align:center;">字段名</th> <th style="text-align:center;">字段含义</th> <th style="text-align:center;">字段类型</th></tr></thead> <tbody><tr><td style="text-align:center;">checkCode</td> <td style="text-align:center;">校验码（<strong>有效期10分钟</strong>）</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">orderId</td> <td style="text-align:center;">第三方订单 id</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">返回结果</td> <td style="text-align:center;">Object</td></tr></tbody></table> <p>如：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;checkCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;checkCode&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;orderId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;your orderId&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-3-查询订单状态"><a href="#_1-3-查询订单状态" class="header-anchor">#</a> 1.3 查询订单状态</h3> <h4 id="_1-3-1-接口"><a href="#_1-3-1-接口" class="header-anchor">#</a> 1.3.1 接口</h4> <p><strong>路径</strong>：<code>/pay-service/third/order/query</code></p> <blockquote><p>​	旧接口<code>/pay-service/third/order/query/single/v2</code>和<code>/pay-service/third/order/query/single</code>不再更新，但是仍然可以正常使用</p></blockquote> <p><strong>请求格式：</strong></p> <table><thead><tr><th>参数名称</th> <th>参数值</th> <th>是否必须</th></tr></thead> <tbody><tr><td>Content-Type</td> <td>application/json</td> <td>是</td></tr></tbody></table> <p><strong>入参：</strong></p> <table><thead><tr><th style="text-align:center;">字段名</th> <th style="text-align:center;">必须</th> <th style="text-align:center;">字段含义</th> <th style="text-align:center;">字段类型</th></tr></thead> <tbody><tr><td style="text-align:center;">appId</td> <td style="text-align:center;">是</td> <td style="text-align:center;">第三方应用 appId</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">nonceStr</td> <td style="text-align:center;">是</td> <td style="text-align:center;">随机数（建议使用UUID去掉&quot;-&quot;）</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">orderId</td> <td style="text-align:center;">是</td> <td style="text-align:center;">第三方订单ID</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">sign</td> <td style="text-align:center;">是</td> <td style="text-align:center;">签名，除sign外的所有非空参数都参与签名（签名算法见<a href="#_1-1-5-常用签名算法">Hmac签名算法</a>）</td> <td style="text-align:center;">String</td></tr></tbody></table> <p><strong>返回数据</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;000001&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;xtcOrderId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;02f8c92618c14553bce451156af61c63&quot;</span><span class="token punctuation">,</span><span class="token comment">//小天才订单Id(uuid形式)</span>
          <span class="token string-property property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">//订单状态(1,&quot;扣款中&quot;),(2,&quot;付款成功&quot;),(3,&quot;扣款失败&quot;),(4,&quot;过期&quot;),(5,&quot;退款中&quot;),(6,&quot;退款完成&quot;);</span>
          <span class="token string-property property">&quot;payTime&quot;</span><span class="token operator">:</span> <span class="token number">1615174308000</span><span class="token comment">//支付时间,  ms时间戳</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-4-支付结果回调"><a href="#_1-4-支付结果回调" class="header-anchor">#</a> 1.4 支付结果回调</h3> <p><strong>注意点：</strong></p> <ol><li>第三方需要提供<strong>测试环境和正式环境的回调接口</strong>，供调试和正式使用。</li> <li>第三方提供 appId 和 url 地址给到小天才，小天才服务器需要进行配置，配置之后才可生效。</li> <li>小天才服务器调用第三方<strong>接口异常</strong>的话(或者<strong>返回的错误码非&quot;000001&quot;</strong>)，会触发重试，10s后重试1次，如果仍旧失败，10s后重试最后一次。</li> <li>请确保回调接口的稳定性，以及做好接口的幂等性和相应的<strong>容错机制</strong>。</li></ol> <h4 id="_1-4-1-回调接口"><a href="#_1-4-1-回调接口" class="header-anchor">#</a> 1.4.1 回调接口</h4> <p>当支付完成后，小天才服务器调用第三方提供的接口将支付结果通知到第三方服务器。</p> <p>第三方提供的回调接口需满足以下要求：</p> <ul><li><p>方法</p> <p>请求方法为： <code>POST</code></p></li> <li><p>请求头</p> <p>请求头为： <code>content-type:application/json</code></p></li> <li><p>入参</p></li></ul> <table><thead><tr><th style="text-align:center;">字段名</th> <th style="text-align:center;">字段含义</th> <th style="text-align:center;">字段类型</th></tr></thead> <tbody><tr><td style="text-align:center;">appId</td> <td style="text-align:center;">分配应用的 appId</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">notifyId</td> <td style="text-align:center;">随机 uuid</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">orderId</td> <td style="text-align:center;">第三方订单 id</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">sign_type</td> <td style="text-align:center;">签名类型（固定传参 rsa）</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">status</td> <td style="text-align:center;">支付结果状态 (1,&quot;扣款中&quot;),(2,&quot;付款成功&quot;),(3,&quot;扣款失败&quot;),(4,&quot;过期&quot;),(5,&quot;退款中&quot;),(6,&quot;退款完成&quot;)</td> <td style="text-align:center;">Integer</td></tr> <tr><td style="text-align:center;">userId</td> <td style="text-align:center;">用户 id</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">sign</td> <td style="text-align:center;">签名（小天才服务器生成的 sign 签名，第三方需做验签处理，签名算法见<a href="#_1-4-3-支付结果签名算法">支付结果签名算法</a>）</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">xtcOrderId</td> <td style="text-align:center;">小天才订单号</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">totalFee</td> <td style="text-align:center;">订单金额，单位:元,固定2位小数</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">finishTime</td> <td style="text-align:center;">支付完成时间,如：2020-12-12 10:10:10</td> <td style="text-align:center;">String</td></tr></tbody></table> <p>如：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;appId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;notifyId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uuid&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;orderId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;orderId&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sign_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rsa&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;status&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;userId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sign&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;xtcOrderId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xtcOrderId&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;totalFee&quot;</span><span class="token operator">:</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;finishTime&quot;</span><span class="token operator">:</span><span class="token string">&quot;2020-12-12 10:10:10&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>接口响应格式</li></ul> <table><thead><tr><th style="text-align:center;">字段名</th> <th style="text-align:center;">字段含义</th> <th style="text-align:center;">字段类型</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">请求返回状态码</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">desc</td> <td style="text-align:center;">请求返回状态描述</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">返回结果</td> <td style="text-align:center;">Object</td></tr></tbody></table> <p>如：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre></div><p>例子：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token string">&quot;/callback&quot;</span><span class="token punctuation">,</span>
    method <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;application/json; charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    consumers<span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;application/json; charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseBody</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">CallBack</span> callBack <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> verify <span class="token operator">=</span> <span class="token class-name">VerifyUtil</span><span class="token punctuation">.</span><span class="token function">verifySign</span><span class="token punctuation">(</span>callBack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResponseBody</span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResponseBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>verify<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        body<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>“<span class="token number">000002</span>”<span class="token punctuation">)</span><span class="token punctuation">;</span>
        body<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span>“verify fail”<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> body<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//业务逻辑</span>
    body<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>“<span class="token number">000001</span>”<span class="token punctuation">)</span>；
    body<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span>“success”<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> body<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_1-4-2-退款回调接口"><a href="#_1-4-2-退款回调接口" class="header-anchor">#</a> 1.4.2 退款回调接口</h4> <p>当小天才管理员在后台执行退款操作之后，小天才通过该接口通知第三方。</p> <p>第三方提供的退款回调接口需满足以下要求：</p> <ul><li><p><strong>方法</strong></p> <p>请求方法为： <code>POST</code></p></li> <li><p><strong>请求头</strong></p> <p>请求头为： <code>application/json</code></p></li> <li><p><strong>入参</strong></p></li></ul> <table><thead><tr><th style="text-align:center;">字段</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">appId</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">分配的应用ID</td></tr> <tr><td style="text-align:center;">notifyId</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">随机数（uuid）</td></tr> <tr><td style="text-align:center;">orderId</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">第三方的订单ID</td></tr> <tr><td style="text-align:center;">refundTime</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">退款时间（yyyy-MM-dd HH:mm:ss格式）</td></tr> <tr><td style="text-align:center;">status</td> <td style="text-align:center;">Integer</td> <td style="text-align:center;">是</td> <td style="text-align:center;">状态(1-&quot;扣款中&quot;,2-&quot;付款成功&quot;,3-&quot;扣款失败&quot;,4-&quot;过期&quot;,5-&quot;退款中&quot;,6-&quot;退款完成&quot;)</td></tr> <tr><td style="text-align:center;">userId</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">订单对应的用户ID</td></tr> <tr><td style="text-align:center;">xtcOrderId</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">小天才的订单ID</td></tr> <tr><td style="text-align:center;">refundFee</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">退款金额</td></tr> <tr><td style="text-align:center;">sign</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">签名值（除了sign和sign_type字段其他非空字段都参与签名，签名算法见 <a href="#_1-4-3-支付结果签名算法">支付结果签名算法</a>）</td></tr> <tr><td style="text-align:center;">sign_type</td> <td style="text-align:center;">String</td> <td style="text-align:center;">是</td> <td style="text-align:center;">签名类型，固定传参rsa</td></tr></tbody></table> <p><strong>出参格式：</strong> JSON</p> <p><strong>出参：</strong></p> <table><thead><tr><th style="text-align:center;">字段</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">code</td> <td style="text-align:center;">String</td> <td style="text-align:center;">响应码（除了&quot;<strong>000001</strong>&quot;，其他响应码默认失败，失败会触发重试）</td></tr> <tr><td style="text-align:center;">desc</td> <td style="text-align:center;">String</td> <td style="text-align:center;">描述</td></tr> <tr><td style="text-align:center;">data</td> <td style="text-align:center;">Object</td> <td style="text-align:center;">响应数据</td></tr></tbody></table> <p><strong>出参示例：</strong></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>接口设计代码示例：</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token string">&quot;/refundCallback&quot;</span><span class="token punctuation">,</span>
    method <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    produces <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;application/json; charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    consumers<span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;application/json; charset=utf-8&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseBody</span> <span class="token function">refundCallback</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">CallBack</span> callBack <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> verify <span class="token operator">=</span> <span class="token class-name">VerifyUtil</span><span class="token punctuation">.</span><span class="token function">verifySign</span><span class="token punctuation">(</span>callBack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResponseBody</span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResponseBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>verify<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        body<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>“<span class="token number">000002</span>”<span class="token punctuation">)</span><span class="token punctuation">;</span>
        body<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span>“verify fail”<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> body<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//业务逻辑</span>
    <span class="token function">bizProcessMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    body<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>“<span class="token number">000001</span>”<span class="token punctuation">)</span>；
    body<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span>“success”<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> body<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_1-4-3-自助退款"><a href="#_1-4-3-自助退款" class="header-anchor">#</a> 1.4.3 自助退款</h4> <h5 id="退款资格校验api"><a href="#退款资格校验api" class="header-anchor">#</a> 退款资格校验API</h5> <ul><li><p><strong>接口路径：</strong> 自定义，确定之后将接口url提供给小天才方即可。</p></li> <li><p><strong>请求消息头：</strong></p> <table><thead><tr><th style="text-align:center;">请求头</th> <th style="text-align:center;">值</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">Content-Type</td> <td style="text-align:center;">application/json</td> <td style="text-align:center;"></td></tr></tbody></table></li> <li><p><strong>请求协议：https</strong></p></li> <li><p><strong>请求方式：POST</strong></p></li> <li><p><strong>数据格式：json</strong></p></li> <li><p><strong>请求参数</strong></p> <table><thead><tr><th>参数</th> <th>类型</th> <th>是否必须</th> <th>描述</th></tr></thead> <tbody><tr><td>xtcOrderId</td> <td>String</td> <td>是</td> <td>小天才订单ID</td></tr> <tr><td>sign</td> <td>String</td> <td>是</td> <td>签名，除sign外的所有非空参数都参与签名（签名算法见<a href="#_1-1-5-常用签名算法">Hmac签名算法</a>）</td></tr></tbody></table> <p>示例：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;xtcOrderId&quot;</span><span class="token operator">:</span><span class="token string">&quot;xtcOrderId&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sign&quot;</span><span class="token operator">:</span><span class="token string">&quot;sign&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><strong>出参示例：</strong></p></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;000001&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;couldRefund&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;leftDay&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
        <span class="token property">&quot;openId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;72dcdc1081554bc29fb87e290685cexx&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;orderAmount&quot;</span><span class="token operator">:</span> <span class="token number">1.00</span><span class="token punctuation">,</span>
        <span class="token property">&quot;refundAmount&quot;</span><span class="token operator">:</span> <span class="token number">0.50</span><span class="token punctuation">,</span>
        <span class="token property">&quot;usedDay&quot;</span><span class="token operator">:</span> <span class="token number">16</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;success&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_1-4-4-支付结果签名算法"><a href="#_1-4-4-支付结果签名算法" class="header-anchor">#</a> 1.4.4 支付结果签名算法</h4> <p>小天才服务器调用第三方，会对关键信息生成签名(sign 字段)，以防篡改，第三方应该对签名进行校验。请在回调接口逻辑中校验签名。<strong>回调信息除了sign和sign_type字段，其他字段都参与验签。后续可能会增加新字段,新字段默认会加入到签名中，请做好兼容处理</strong>。
<strong>校验签名示例</strong></p> <blockquote><p>下面的例子是服务器 Java、Php 代码，如果第三方服务器是其他的语言，请参考该代码自己实现 RSA 校验即可。</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>校验签名示例<span class="token operator">--</span>java

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> sign <span class="token operator">=</span> <span class="token string">&quot;签名&quot;</span><span class="token punctuation">;</span>
    
      <span class="token comment">//签名公钥</span>
      <span class="token class-name">String</span> publicKey <span class="token operator">=</span> <span class="token string">&quot;接入支付功能的时候小天才服务器分配好的公钥&quot;</span><span class="token punctuation">;</span>
      <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      注意：实际参与签名的字段以接口文档说明为准，以下字段只是做一个示例的作用。
      param<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;appId&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;100010&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      param<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;notifyId&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;uuid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      param<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;orderId&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;orderId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      param<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      param<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      param<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;xtcOrderId&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;xtcOrderId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      param<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;totalFee&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1.00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      param<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;finishTime&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2020-12-12 10:10:10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//      param.put(&quot;其他字段&quot;,&quot;xxx&quot;);</span>

      <span class="token class-name">String</span> preSignStr <span class="token operator">=</span> <span class="token function">createLinkString</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">boolean</span> isSign <span class="token operator">=</span> <span class="token function">verify</span><span class="token punctuation">(</span>preSignStr<span class="token punctuation">,</span> sign<span class="token punctuation">,</span> publicKey<span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">/**
* 把数组所有元素排序，并按照“参数=参数值”的模式用“&amp;”字符拼接成字符串
*
* @param params 需要排序并参与字符拼接的参数组
* @return 拼接后字符串
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">createLinkString</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">String</span> prestr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
      <span class="token class-name">String</span> key <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Object</span> value <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">continue</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span><span class="token comment">// 拼接时，不包括最后一个&amp;字符</span>
          prestr <span class="token operator">=</span> prestr <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">{</span>
          prestr <span class="token operator">=</span> prestr <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> prestr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
* RSA验签名检查
*
* @param content 待签名数据
* @param sign 签名值
* @param publicKey xtcpay公钥
* @param charset 编码格式 UTF-8
* @return 布尔值
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token class-name">String</span> sign<span class="token punctuation">,</span> <span class="token class-name">String</span> publicKey<span class="token punctuation">,</span> <span class="token class-name">String</span> charset<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;RSA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//Base64是base64编码工具类，第三方可自行替换自己的工具类</span>
          <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encodedKey <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">PublicKey</span> pubKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>encodedKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
          <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span>Signature</span> signature <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span>Signature</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;SHA1WithRSA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
          signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>pubKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
          signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
          <span class="token comment">//Base64是base64编码工具类，第三方可自行替换自己的工具类</span>
          <span class="token keyword">boolean</span> bverify <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> bverify<span class="token punctuation">;</span>
    
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
    <span class="token comment">//            LOGGER.error(e);</span>
      <span class="token punctuation">}</span>
    
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code>校验签名示例<span class="token operator">--</span>php
   <span class="token comment">/**
    * 小天才支付结果回调方法。
    * @param Request $request
    * @return false|string
    */</span>
   <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">notifyUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token comment">//获取请求body里面的数据。</span>
       <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;php://input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//json字符串转数组</span>
       <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//验签</span>
       <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">checkSign</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//通过验签 且状态为2 支付成功的回调 小天才文档</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token comment">//订单支付成功后的操作。。。。。</span>
       <span class="token punctuation">}</span>
       <span class="token comment">//通过验签 且状态为6 退款成功的回调 小天才文档</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">//订单退款成功后的操作。。。。。</span>
       <span class="token punctuation">}</span>

      <span class="token comment">//返回数据给小天才</span>
       <span class="token variable">$arr</span><span class="token operator">=</span><span class="token punctuation">[</span>
           <span class="token string double-quoted-string">&quot;code&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;000001&quot;</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;desc&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;success&quot;</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;data&quot;</span><span class="token operator">=&gt;</span> <span class="token constant">null</span>
       <span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">/**
    * 根据小天才提供的公钥验签
    * @param $data 小天才支付接口回调服务器的post数据转换后的数组
    * @return bool 判断验签是否成功
    */</span>
   <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkSign</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

       <span class="token comment">//拼接验证字符串，此处根据小天才文档可能会改变，如果验签失败可以看最新的小天才文档整理参数</span>
       注意：实际参与签名的字段以接口文档说明为准，以下字段只是做一个示例的作用。
       <span class="token variable">$arr</span><span class="token operator">=</span><span class="token punctuation">[</span>
           <span class="token string double-quoted-string">&quot;appId&quot;</span><span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;小天才提供的appId&quot;</span><span class="token punctuation">,</span><span class="token comment">//小天才提供的appId</span>
           <span class="token string double-quoted-string">&quot;notifyId&quot;</span><span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'notifyId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;orderId&quot;</span><span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'orderId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;status&quot;</span><span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;userId&quot;</span><span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;xtcOrderId&quot;</span><span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'xtcOrderId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;totalFee&quot;</span><span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'totalFee'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token string double-quoted-string">&quot;finishTime&quot;</span><span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'finishTime'</span><span class="token punctuation">]</span>
            <span class="token comment">//&quot;新字段&quot;=&gt; $data['新字段']</span>
       <span class="token punctuation">]</span><span class="token punctuation">;</span>

       <span class="token comment">//签名步骤一：按字典序排序参数</span>
       <span class="token function">ksort</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//签名步骤二：按照“参数=参数值”的模式用“&amp;”字符拼接成字符串</span>
       <span class="token variable">$prestr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
       <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=&gt;</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">==</span> <span class="token variable">$count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 拼接时，不包括最后一个&amp;字符</span>
                    <span class="token variable">$prestr</span> <span class="token operator">.=</span>  <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;=&quot;</span> <span class="token operator">.</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token variable">$prestr</span> <span class="token operator">.=</span>  <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;=&quot;</span> <span class="token operator">.</span> <span class="token function">strval</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&amp;&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

       <span class="token comment">//步骤三:拼接openssl公钥并按64长度拆行</span>
       <span class="token variable">$publicKey</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;小天才提供的公钥&quot;</span>

       <span class="token variable">$publicKey</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;-----BEGIN PUBLIC KEY-----\n&quot;</span> <span class="token operator">.</span>
           <span class="token function">wordwrap</span><span class="token punctuation">(</span><span class="token variable">$publicKey</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span> <span class="token operator">.</span>
           <span class="token string double-quoted-string">&quot;\n-----END PUBLIC KEY-----&quot;</span><span class="token punctuation">;</span>

       <span class="token comment">//步骤四：转换为openssl格式密钥</span>
       <span class="token variable">$publicKeyId</span> <span class="token operator">=</span> <span class="token function">openssl_pkey_get_public</span><span class="token punctuation">(</span><span class="token variable">$publicKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//步骤五：公钥SHA1验签</span>
       <span class="token variable">$sign</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sign'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">openssl_verify</span><span class="token punctuation">(</span><span class="token variable">$prestr</span><span class="token punctuation">,</span> <span class="token variable">$sign</span><span class="token punctuation">,</span> <span class="token variable">$publicKeyId</span><span class="token punctuation">,</span><span class="token constant">OPENSSL_ALGO_SHA1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">openssl_free_key</span><span class="token punctuation">(</span><span class="token variable">$publicKeyId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//返回验签结果</span>
       <span class="token keyword">return</span> <span class="token variable">$result</span> <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token constant boolean">true</span> <span class="token punctuation">:</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

</code></pre></div><h3 id="_1-5-网页支付预下单"><a href="#_1-5-网页支付预下单" class="header-anchor">#</a> 1.5 网页支付预下单</h3> <p><strong>接口：</strong> /pay-service/third/wapPayPre</p> <p><strong>请求方式：</strong> POST</p> <p><strong>请求头</strong></p> <table><thead><tr><th>参数名称</th> <th>参数值</th> <th>是否必须</th></tr></thead> <tbody><tr><td>Content-Type</td> <td>application/json</td> <td>是</td></tr></tbody></table> <p><strong>入参</strong></p> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">是否必须</th> <th style="text-align:center;">备注</th></tr></thead> <tbody><tr><td style="text-align:left;">openId</td> <td style="text-align:center;">string</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">手表openId</td></tr> <tr><td style="text-align:left;">ip</td> <td style="text-align:center;">string</td> <td style="text-align:center;">非必须</td> <td style="text-align:center;">客户端IP，当payChannel=2即为微信支付时该参数必填</td></tr> <tr><td style="text-align:left;">payModel</td> <td style="text-align:center;">number</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">支付类型 (3.H5网页支付,4-微信内JSAPI支付)。<strong>注</strong>：若想在微信里边提供支付宝支付，该值<strong>还是传3</strong></td></tr> <tr><td style="text-align:left;">title</td> <td style="text-align:center;">string</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">订单标题</td></tr> <tr><td style="text-align:left;">refundOrderId</td> <td style="text-align:center;">string</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">第三方订单id</td></tr> <tr><td style="text-align:left;">totalFee</td> <td style="text-align:center;">number</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">订单总金额（金额为两位精度的小数）</td></tr> <tr><td style="text-align:left;">productInfos</td> <td style="text-align:center;">object []</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">商品信息</td></tr> <tr><td style="text-align:left;">├─ number</td> <td style="text-align:center;">number</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">商品数量</td></tr> <tr><td style="text-align:left;">├─ productId</td> <td style="text-align:center;">string</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">商品ID</td></tr> <tr><td style="text-align:left;">├─ price</td> <td style="text-align:center;">decimal</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">单价</td></tr> <tr><td style="text-align:left;">├─ productName</td> <td style="text-align:center;">string</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">商品名称</td></tr> <tr><td style="text-align:left;">appId</td> <td style="text-align:center;">string</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">开放平台appId</td></tr> <tr><td style="text-align:left;">payChannel</td> <td style="text-align:center;">number</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">支付渠道(1.支付宝，2.微信)</td></tr> <tr><td style="text-align:left;">returnUrl</td> <td style="text-align:center;">string</td> <td style="text-align:center;">非必须</td> <td style="text-align:center;">支付结束之后的跳转界面</td></tr> <tr><td style="text-align:left;">sign</td> <td style="text-align:center;">string</td> <td style="text-align:center;">必须</td> <td style="text-align:center;">签名，除sign外的所有非空参数都参与签名（签名算法见<a href="#_1-1-5-常用签名算法">Hmac签名算法</a>）</td></tr></tbody></table> <p><strong>返回数据</strong></p> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">备注</th></tr></thead> <tbody><tr><td style="text-align:left;">code</td> <td style="text-align:center;">string</td> <td style="text-align:center;">响应码</td></tr> <tr><td style="text-align:left;">data</td> <td style="text-align:center;">object</td> <td style="text-align:center;">出参</td></tr> <tr><td style="text-align:left;">├─ orderId</td> <td style="text-align:center;">string</td> <td style="text-align:center;">支付中心的订单ID</td></tr> <tr><td style="text-align:left;">├─ jumpUrl</td> <td style="text-align:center;">string</td> <td style="text-align:center;">H5跳转的页面链接</td></tr> <tr><td style="text-align:left;">desc</td> <td style="text-align:center;">string</td> <td style="text-align:center;">描述</td></tr></tbody></table> <h3 id="_1-6-支付问题解答"><a href="#_1-6-支付问题解答" class="header-anchor">#</a> 1.6 支付问题解答</h3> <ul><li><p><strong>checkCode有啥用？</strong></p> <p>checkCode是由小天才服务器生成的uuid,用来标识订单关键信息。当客户端下单时，xtc服务器会判断订单信息与第三方服务器生成checkCode时提交的订单信息是否一致，以此来防止客户端提交的订单信息被篡改。使用同一个orderId可以重复调用checkCode接口，旧的checkCode将失效。一个orderId在同一时刻只能有一个有效的checkCode.checkCode如没有使用，会保存一个月(暂定)，使用过的checkCode变成无效。</p></li> <li><p><strong>生成二维码时（下单时）失败，返回12020、12021</strong></p> <ul><li>重复调用了checkCode接口，下单时使用了旧的checkCode，会返回12021</li> <li>手表环境和第三方服务器环境不一致，导致找不到checkCode，下单时会返回12020</li> <li>下单时传入的totalFee和第三方服务器调用checkCode接口传入的totalFee不一致（包括小数位不一致），下单时会返回12021</li></ul></li> <li><p><strong>生成二维码时（下单时）失败，返回12001、12099</strong></p> <p>请确认传入的订单、商品信息完整，尽量将可填的信息补全，如productName,title,price,productId等</p></li> <li><p><strong>回调验证签名失败</strong></p> <ul><li>确认totalFee校验签名时是否是2位小数，xtc服务器使用2位小数生成签名（不足2位小数补0,如30.00,30.10）</li> <li>确认对接时验签的字段和最新文档中验签的字段是否一致，如不一致，请联系xtc开发，xtc服务器对返回不同的字段有做控制</li> <li>确认为null的字段是否也加入了验签，xtc服务器对为null的字段没有加入验签</li></ul></li> <li><p><strong>回调失败有没有重试？</strong></p> <p>目前有简单的重试机制，10秒重试一次，一共重试2次。即：回调失败-&gt;10s后重试一次-&gt;仍旧失败-&gt;10s后重试最后一次-&gt;结束
对于状态未同步的订单，第三方需调订单查询接口查询最新状态</p></li> <li><p><strong>没有对应语言的签名算法demo</strong></p> <p>签名算法为SHA1WithRSA，文档中提供了java和php版的demo，xtc使用java技术栈，其他语言的需要接入方自行开发</p></li> <li><p><strong>订单多久过期？</strong></p> <ul><li>手表二维码支付：
手表生成了二维码，xtc此时会生成订单。如果二维码一直未扫描（未唤起支付宝/微信），则订单一直是未支付状态，
如果二维码被支付宝/微信扫描了，但是没有支付或者支付失败，此时微信和支付宝那边会生成订单，微信订单过期时间是49个小时（暂定），
支付宝订单的过期时间是3分钟（暂定）。支付宝/微信订单过期后，xtc订单会变成过期状态。
（微信和支付宝订单过期时间这样设置的原因暂未知，待确认后会统一）</li> <li>家长app内支付：
通过家长app生成的订单，如果唤起了微信和支付宝，微信和支付宝那边会生成订单，微信订单过期时间是60分钟（暂定），
支付宝订单的过期时间是60分钟（暂定）。支付宝/微信订单过期后，xtc订单会变成过期状态。</li> <li>网页支付：同手表二维码支付。</li></ul></li> <li><p><strong>网页支付微信报 商家参数错误 如何解决？</strong></p> <p>请确保传参按照文档描述填写，比如IP地址必须为发起支付的客户端地址，不能填127.0.0.1等。</p></li></ul> <h2 id="二、手表端扫码支付sdk说明"><a href="#二、手表端扫码支付sdk说明" class="header-anchor">#</a> 二、手表端扫码支付SDK说明</h2> <p>适用于手表端的第三方 APP 中集成支付功能，调试前请前往应用中心将手表&quot;设置&quot;应用升级至最新版本</p> <p><strong>（注：手表端获取支付 SDK 能力需要注册开发者账号）</strong></p> <h3 id="_2-1-注册开发者账号"><a href="#_2-1-注册开发者账号" class="header-anchor">#</a> 2.1 注册开发者账号</h3> <p>通过小天才开放平台注册开发者账号，并创建三方应用，获取 appId 和 appSecret 信息</p> <p>点击首页右上方的“<strong>申请入驻</strong>”申请注册，完成注册后生成信息将通过微信发送</p> <p><img src="data:image/png;base64,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" alt=""></p> <h3 id="_2-2-流程"><a href="#_2-2-流程" class="header-anchor">#</a> 2.2 流程</h3> <h4 id="_2-2-1-简易流程图-sdk1-0-3之后版本"><a href="#_2-2-1-简易流程图-sdk1-0-3之后版本" class="header-anchor">#</a> 2.2.1 简易流程图（SDK1.0.3之后版本）</h4> <p><img src="static/picture/paysdk_lc1.d976f013.png" alt=""></p> <h4 id="_2-2-2-整体流程图"><a href="#_2-2-2-整体流程图" class="header-anchor">#</a> 2.2.2 整体流程图</h4> <p><img src="static/picture/paysdk02.94cfdd90.png" alt=""></p> <h3 id="_2-3-搭建开发环境"><a href="#_2-3-搭建开发环境" class="header-anchor">#</a> 2.3 搭建开发环境</h3> <p>将 <strong>XTC_payApi.aar</strong> 复制粘贴到工程的 app/libs/目录下。</p> <blockquote><p>备注：此 AAR 当正式注册完成开发者账号之后，联系小天才的开发维护人员获取</p></blockquote> <p>在 您 Android 项目的 app 目录下的 build.gradle 文件中添加以下代码，引入支付的 AAR SDK。</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>android<span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        flatDir <span class="token punctuation">{</span>
        dirs <span class="token string">'libs'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token comment">// 最新的SDK版本为1.0.3  </span>
    implementation <span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'XTC‐payApi‐1.0.3'</span><span class="token punctuation">,</span> ext<span class="token punctuation">:</span> <span class="token string">'aar'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li><p><strong>注意（重要）：</strong></p> <blockquote><ul><li>之前的<strong>支付SDK 1.0.0—1.0.2版本</strong>中，第三方需要用户授权拿到openId，再将openId传入SDK中，如果不授权则不能使用，这是十分不便的，</li> <li>因此，从<strong>支付SDK1.0.3版本之后</strong>，我们去除了这个限制，第三方调用SDK支付时只要<strong>增加一个参数</strong><code>req.isUseSdkOpenid = true</code> ，这样小天才会自动获取openId，并在<strong>支付完成之后将此openId回传给第三方</strong>。
修改点如下图红色部分</li> <li>如果你选择接入的是支付聚合码，那么需要满足支付聚合码的<a href="#_5-2-前提条件">前提条件</a>。</li></ul></blockquote></li></ul> <p><img src="static/picture/paysdk_lc2.b1d9d4b7.png" alt=""></p> <blockquote><p>  后续新接入的第三方开发者都会发送支付SDK1.0.3版本，</p> <p>  目前已经接入了支付SDK 1.0.0-1.0.2版本的第三方开发者<strong>需要重新获取</strong>支付SDK1.0.3版本并进行适配。</p></blockquote> <h3 id="_2-4-表端示例代码"><a href="#_2-4-表端示例代码" class="header-anchor">#</a> 2.4 表端示例代码</h3> <h4 id="_2-4-1-androidmanifest-xml-设置"><a href="#_2-4-1-androidmanifest-xml-设置" class="header-anchor">#</a> 2.4.1 AndroidManifest.xml 设置</h4> <p><strong>添加必要的权限</strong>支持, 请求支付的界面启动模式使用 <strong>singleTask</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--添加必要的权限支持--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses‐permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.INTERNET<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!--请求支付的界面启动模式使用 singleTask--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.MainActivity<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>launchMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>singleTask<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h4 id="_2-4-2-发送请求"><a href="#_2-4-2-发送请求" class="header-anchor">#</a> 2.4.2 发送请求</h4> <p>下面代码直接全部 copy 到你的代码中，只改那些可变的参数，其他的地方进来不用改。</p> <p>之前有第三方开发人员擅自改动，导致序列化出错，无法进行支付。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">PayApiManager</span> payApiManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayApiManager</span><span class="token punctuation">(</span><span class="token class-name">TestActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">SendPayMesToXTC<span class="token punctuation">.</span>Request</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendPayMesToXTC<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 填入您的应用的appId,第三方应用注册小天才开放平台时分配的 AppID</span>
req<span class="token punctuation">.</span>appId <span class="token operator">=</span> <span class="token string">&quot;100001&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 第三方服务器提供的第三方订单id，请自行保证唯一  （第三方自己生成，40 个字符长度）</span>
req<span class="token punctuation">.</span>orderId <span class="token operator">=</span> <span class="token constant">ORDER_ID</span><span class="token punctuation">;</span>
<span class="token comment">// 下面两个属性在SDK 1.0.0-1.0.2版本和SDK1.0.3版本有所不同，第三方开发者得注意看看</span>

<span class="token comment">// 账户系统授权获取到的openid，这个属性在SDK1.0.3以上版本以后第三方开发者可以不需要传入，SDK自动去小天才服务器获取，此属性在SDK1.0.3以上版本已经Deprecated</span>
<span class="token comment">// 如果下面的isUseSdkOpenid属性你们传入为false的话，那么就会第三方开发者使用传入的openId</span>
<span class="token comment">// 如果下面的isUseSdkOpenid属性你们传入为true的话，那么就会屏蔽第三方开发者使用传入的openId，直接从小天才服务器获取新的openid</span>
req<span class="token punctuation">.</span>openId <span class="token operator">=</span> <span class="token constant">OPEN_ID</span><span class="token punctuation">;</span>

<span class="token comment">//该属性只有SDK1.0.3以上版本才有，如果是老版本的SDK的话，则会默认为false</span>
<span class="token comment">//如果isUseSdkOpenid为true的话，上面第三方传入的openId不生效，支付SDK内部   会替换掉    实际从服务器主动获取的openid</span>
<span class="token comment">//如果isUseSdkOpenid为false的话，上面第三方传入的openId有效， 支付SDK内部 不会去替换掉  实际从服务器主动获取的openid</span>
req<span class="token punctuation">.</span>isUseSdkOpenid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// 第三方服务器返回的验证码   校验码，校验订单是否有效（通过获取支付校验码接口获取）</span>
req<span class="token punctuation">.</span>checkCode <span class="token operator">=</span> <span class="token constant">CHECK_CODE</span><span class="token punctuation">;</span>
<span class="token comment">// 选择支付方式 0：默认值，支持支付宝和微信支付，用户选择	  1:扫描支付方式-支付宝  2:扫描支付方式-微信  3:扫描支付方式-聚合码（需要SDK版本大于等于1.0.4，见下方注意3）</span>
req<span class="token punctuation">.</span>payType <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">// 设置你们订单页面自己要展示的图片</span>
req<span class="token punctuation">.</span><span class="token function">setThumbImage</span><span class="token punctuation">(</span><span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_portrait_friend<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//订单总金额（金额为两位精度的小数）</span>
req<span class="token punctuation">.</span>totalPrice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;123.45&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//订单标题，展示在微信或支付宝的标题</span>
req<span class="token punctuation">.</span>describeTitle <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//订单商品列表信息</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductInfo</span><span class="token punctuation">&gt;</span></span> productList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductInfo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//订单商品</span>
<span class="token class-name">ProductInfo</span> productInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProductInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//订单商品 Id</span>
productInfo<span class="token punctuation">.</span><span class="token function">setProductId</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//订单商品 名称</span>
productInfo<span class="token punctuation">.</span><span class="token function">setProductName</span><span class="token punctuation">(</span><span class="token string">&quot;vip3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//订单商品 总价（非单价）</span>
productInfo<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;123.45&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//订单商品 数量</span>
productInfo<span class="token punctuation">.</span><span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//将订单商品添加到订单商品集合</span>
productList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>productInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 这里是序列化products订单List，别copy错了，否则请求反序列化json的操作会出错。</span>
req<span class="token punctuation">.</span>productInfos <span class="token operator">=</span> <span class="token class-name">GsonUtil</span><span class="token punctuation">.</span><span class="token function">toJSON</span><span class="token punctuation">(</span>productList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 发送前建议打印下日志，方便第三方开发人员自己核对下各参数是否正确</span>
<span class="token class-name">LogUtil</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span><span class="token string">&quot;req = &quot;</span> <span class="token operator">+</span> req<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过SDK请求支付</span>
payApiManager<span class="token punctuation">.</span><span class="token function">sendRequestToXTC</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre></div><ul><li><strong>注意1：</strong></li></ul> <blockquote><p>在调用payApiManager.sendRequestToXTC(req); 之前建议通过日志打印出req的所有信息，便于出现问题的时候查看req的参数是否完整。
之前有不少开发者部分参数为null导致二维码生成失败，导致很难查问题，如果加上了日志打印，开发者核对参数时候有为空的就很容易分析出问题了。</p></blockquote> <ul><li><strong>注意2：</strong></li></ul> <blockquote><p>如果你的项目开启了混淆，因为上面的订单信息会序列化成 json 格式，所以请参考下面的 【2.4.5 注意事项】 章节配置好混淆配置。</p></blockquote> <ul><li><strong>注意3：</strong></li></ul> <blockquote><p>如果您想接入的是支付聚合码，那么必须满足下方条件才能正常接入：</p> <ol><li>将SDK版本升级到<strong>1.0.4以上（含1.0.4）</strong>，调整<code>req.payType</code>的传参为<strong>3</strong>即可自动更换为聚合码。</li> <li>将手表基础应用<strong>升级到2.8.00及其以上</strong></li></ol></blockquote> <h4 id="_2-4-3-接收支付结果"><a href="#_2-4-3-接收支付结果" class="header-anchor">#</a> 2.4.3 接收支付结果</h4> <blockquote><p>下面的这些错误码 可以参考 章节 <strong>【1.1.4 服务器错误码】</strong> 中列举的</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//第一步：在页面实现IPayResponseCallback接口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token keyword">implements</span> <span class="token class-name">IPayResponseCallback</span> <span class="token punctuation">{</span>

    <span class="token comment">// 第三步，初始化PayApiManager实例</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        authManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PayApiManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 第四步 处理返回数据，触发IPayResponseCallback</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onNewIntent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onNewIntent</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setIntent</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        authManager<span class="token punctuation">.</span><span class="token function">handleIntent</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//第二步：实现onResp和onReq方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequest</span><span class="token punctuation">(</span><span class="token class-name">BaseRequest</span> baseRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//to‐do 暂时可以不管</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResponse</span><span class="token punctuation">(</span><span class="token class-name">BaseResponse</span> baseResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这3行代码是打印支付SDK回调回来的数据,</span>
        <span class="token comment">// 在SDK1.0.3版本以上及其配套的手表设置版本才会有openid回调，SDK 1.0.0-1.0.2版本没有openid回调</span>
        <span class="token class-name">SendPayMesToXTC<span class="token punctuation">.</span>Response</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SendPayMesToXTC<span class="token punctuation">.</span>Response</span><span class="token punctuation">)</span> baseResponse<span class="token punctuation">;</span>
        <span class="token class-name">LogUtil</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">&quot;onResponse called with: response=&quot;</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// toast提示支付回调回来的openid，这个openid在支付SDK1.0.3之后不需要第三方开发者主动传给支付SDK，</span>
        <span class="token comment">// 支付SDK会自己去小天才服务器获取，并通过onResponse回调给第三方，</span>
        <span class="token comment">// 第三方可以在此处保存这个openid传给第三方自己的业务服务器，以备后续和小天才对账核对使用</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;支付回调  openid 为： &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>openid <span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token constant">LENGTH_SHORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        
        
        
        <span class="token comment">//异常情况下errorCode可能为空等，注意判空</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BaseResponse<span class="token punctuation">.</span>Code</span><span class="token punctuation">.</span><span class="token constant">PAY_SUCCESS</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>baseResponse<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;支付成功&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token constant">LENGTH_SHORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> errorToast <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">// 下面的这些错误码  可以参考 章节  1.1.4 服务器错误码 中列举的</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>baseResponse<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token class-name">BaseResponse<span class="token punctuation">.</span>Code</span><span class="token punctuation">.</span><span class="token constant">ERROR_NETWORK</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;网络异常&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;1003&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;支付频繁,请稍后再使用&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12001&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;参数无效&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12005&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;支付数额不相同&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12006&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;订单创建错误&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12008&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;支付中心获取支付凭证失败&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12009&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;订单号不存在&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12010&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;传参用户和实际用户信息不符，无法获取订单详情&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12012&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;第三方订单id没变，但是商品内容有修改&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12013&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;订单已支付&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12099&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;其它错误&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;12201&quot;</span><span class="token operator">:</span>
                    errorToast <span class="token operator">=</span> <span class="token string">&quot;请求参数有问题&quot;</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token comment">//还有可能有一些异常的错误返回码</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-4-4-可选-通过广播可以接收支付成功信息"><a href="#_2-4-4-可选-通过广播可以接收支付成功信息" class="header-anchor">#</a> 2.4.4 可选：通过广播可以接收支付成功信息</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//动态注册</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initRis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">IntentFilter</span> intentFilter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    intentFilter<span class="token punctuation">.</span><span class="token function">addAction</span><span class="token punctuation">(</span><span class="token string">&quot;com.xtc.pay.success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">registerReceiver</span><span class="token punctuation">(</span>myBroadcastReceiver<span class="token punctuation">,</span>intentFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">BroadcastReceiver</span> myBroadcastReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 第三方订单id</span>
        <span class="token class-name">String</span> refundOrderId <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">&quot;refundOrderId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span><span class="token string">&quot;onReceive refundOrderId = &quot;</span> <span class="token operator">+</span> refundOrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_2-4-5-注意事项"><a href="#_2-4-5-注意事项" class="header-anchor">#</a> 2.4.5 注意事项</h4> <p>如果你的 APP 开启了混淆，请配置一下支付相关的类不混淆，不然可能会导致订单信息序列化的时候因为混淆的源，导致反序列化的时候解析不出来。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">-</span>keep <span class="token keyword">class</span>  com<span class="token punctuation">.</span>xtc<span class="token punctuation">.</span>payapi<span class="token punctuation">.</span>*<span class="token operator">*</span><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

</code></pre></div><h3 id="_2-5-获取校验码"><a href="#_2-5-获取校验码" class="header-anchor">#</a> 2.5 获取校验码</h3> <p>参考章节 <a href="#_1-2-获取校验码">1.2 获取校验码</a></p> <h3 id="_2-6-查询订单状态"><a href="#_2-6-查询订单状态" class="header-anchor">#</a> 2.6 查询订单状态</h3> <p>参考章节 <a href="#_1-3-查询订单状态">1.3 查询订单状态</a></p> <h3 id="_2-7-支付结果回调"><a href="#_2-7-支付结果回调" class="header-anchor">#</a> 2.7 支付结果回调</h3> <p>参考章节 <a href="#_1-4-支付结果回调">1.4 支付结果回调</a></p> <h2 id="三、小天才app支付sdk说明"><a href="#三、小天才app支付sdk说明" class="header-anchor">#</a> 三、小天才APP支付SDK说明</h2> <p>适用于小天才手机 APP 客户端中的支付功能。前提是已经在小天才手机 APP 接入了应用服务号。</p> <blockquote><p><strong>注意事项：受苹果内购规则限制，小天才家长 APP（ios 端）暂不支持虚拟商品的上线与支付，android 端无影响</strong></p></blockquote> <blockquote><p>关于应用服务器的接入流程参考链接： <a href="08-service.html" target="_blank" rel="noopener noreferrer">应用服务号<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="_3-1-整体流程"><a href="#_3-1-整体流程" class="header-anchor">#</a> 3.1 整体流程</h3> <ol><li>用户在第三方客户端（小天才 APP 里面的第三方应用服务号）选择需要购买的商品</li> <li>调用第三方服务器（第三方服务器需要调用 XTC 服务器获取支付校验码）获取订单号和支付校验码</li> <li>带着支付校验码通过 jsBridge 交互库来调用 <code>xtc.createXtcPayTrade</code>方法 进行支付</li> <li>支付完成后，第三方客户端调用第三方服务器查询订单状态（第三方服务器需要调用 XTC 服务器获取订单状态）</li></ol> <p><strong>流程图如下所示：</strong></p> <p><img src="static/picture/paysdk01.77760032.jpg" alt=""></p> <h3 id="_3-2-获取支付校验码"><a href="#_3-2-获取支付校验码" class="header-anchor">#</a> 3.2 获取支付校验码</h3> <p>参考章节 <a href="#_1-2-获取校验码">1.2 获取校验码</a></p> <h3 id="_3-3-支付订单"><a href="#_3-3-支付订单" class="header-anchor">#</a> 3.3 支付订单</h3> <p><strong>方法名：createXtcPayTrade（xtcJSBridge 库方法）</strong></p> <ul><li><strong>传参说明</strong></li></ul> <table><thead><tr><th style="text-align:center;">字段名</th> <th style="text-align:center;">字段含义</th> <th style="text-align:center;">字段类型</th></tr></thead> <tbody><tr><td style="text-align:center;">appId</td> <td style="text-align:center;">第三方应用注册小天才开放平台时分配的 AppID</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">openId</td> <td style="text-align:center;">一个手表的一个应用号 对应唯一的 openId</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">watchNickName</td> <td style="text-align:center;">手表昵称</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">checkCode</td> <td style="text-align:center;">校验码，校验订单是否有效（获取支付校验码接口获取）</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">refundOrderId</td> <td style="text-align:center;">第三方订单 id（orderId）</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">totalFee</td> <td style="text-align:center;">订单总金额（金额为两位精度的小数）</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">title</td> <td style="text-align:center;">订单标题</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">productInfos</td> <td style="text-align:center;">商品信息</td> <td style="text-align:center;"><code>List&lt;Good&gt;</code></td></tr></tbody></table> <p><strong>其中 productInfos 包含的字段：</strong></p> <table><thead><tr><th style="text-align:center;">字段名</th> <th style="text-align:center;">字段含义</th> <th style="text-align:center;">字段类型</th></tr></thead> <tbody><tr><td style="text-align:center;">productId</td> <td style="text-align:center;">商品 Id</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">productName</td> <td style="text-align:center;">商品名称</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">price</td> <td style="text-align:center;">商品价格（总价）</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">number</td> <td style="text-align:center;">商品数量</td> <td style="text-align:center;">int</td></tr></tbody></table> <p><strong>注意：（totalFee、watchNickName、title、商品名称 productName；这些显示信息不能为空。）</strong></p> <ul><li><strong>CALLBACK 回调说明 :</strong></li></ul> <p><strong>触发回调时间：退出 App 支付界面时触发回调（App 支付界面是指小天才 App 自身的选择支付方式界面）。</strong></p> <ul><li><strong>回调函数</strong></li></ul> <table><thead><tr><th>名称</th> <th>类型</th> <th>必填</th> <th>描述</th></tr></thead> <tbody><tr><td>success</td> <td>Function</td> <td>否</td> <td>接口调用成功的回调函数</td></tr> <tr><td>fail</td> <td>Function</td> <td>否</td> <td>接口调用失败的回调函数</td></tr> <tr><td>complete</td> <td>Function</td> <td>否</td> <td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table> <ul><li><strong>code 说明</strong></li></ul> <table><thead><tr><th>code</th> <th>描述</th></tr></thead> <tbody><tr><td>000001</td> <td>支付流程完成（不代表支付成功，需根据服务器查询）</td></tr> <tr><td>000007</td> <td>参数无效</td></tr></tbody></table> <ul><li><strong>示例 ：</strong></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">appId</span><span class="token operator">:</span> <span class="token string">'100001'</span><span class="token punctuation">,</span> <span class="token comment">//开放平台appId</span>
    <span class="token literal-property property">openId</span><span class="token operator">:</span> <span class="token string">'openId'</span><span class="token punctuation">,</span> <span class="token comment">//手表openId</span>
    <span class="token literal-property property">watchNickName</span><span class="token operator">:</span> <span class="token string">'小天'</span><span class="token punctuation">,</span> <span class="token comment">//手表昵称</span>
    <span class="token literal-property property">checkCode</span><span class="token operator">:</span> <span class="token string">'ASDFRGFSSS'</span><span class="token punctuation">,</span> <span class="token comment">//校验码，'获取支付校验码'接口获取</span>
    <span class="token literal-property property">refundOrderId</span><span class="token operator">:</span> <span class="token string">'abcde12345abcde12345abcde12345abcde12345'</span><span class="token punctuation">,</span> <span class="token comment">//第三方订单id</span>
    <span class="token literal-property property">totalFee</span><span class="token operator">:</span> <span class="token number">110.01</span><span class="token punctuation">,</span> <span class="token comment">//订单总金额（金额为两位精度的小数）</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'订单标题'</span><span class="token punctuation">,</span> <span class="token comment">//订单标题</span>
    <span class="token literal-property property">productInfos</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">productId</span><span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">productName</span><span class="token operator">:</span> <span class="token string">'vip3'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token string">'33'</span><span class="token punctuation">,</span> <span class="token comment">//总价（非单价）</span>
            <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">productId</span><span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">productName</span><span class="token operator">:</span> <span class="token string">'vip3'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token string">'33'</span><span class="token punctuation">,</span> <span class="token comment">//总价（非单价）</span>
            <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//商品信息</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xtc<span class="token punctuation">.</span><span class="token function">createXtcPayTrade</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 一定会执行</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行成功回调</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行失败回调</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="_3-4-查询订单状态"><a href="#_3-4-查询订单状态" class="header-anchor">#</a> 3.4 查询订单状态</h3> <p>参考章节 <a href="#_1-3-查询订单状态">1.3 查询订单状态</a></p> <h2 id="四、网页支付"><a href="#四、网页支付" class="header-anchor">#</a> 四、网页支付</h2> <p>适用于H5浏览器的支付，以及微信内置浏览器的支付。</p> <h3 id="_4-1-整体流程"><a href="#_4-1-整体流程" class="header-anchor">#</a> 4.1 整体流程</h3> <ol><li>用户在手表应用中点击购买商品之后，第三方根据自身的链接（需携带openId）生成二维码。</li> <li>用户使用微信/浏览器等扫码之后跳转到第三方的H5界面，浏览商品之后点击支付。</li> <li>此时第三方调用小天才的<a href="#_1-5-网页支付预下单">预下单接口</a>，拿到跳转链接和小天才订单号，跳转到链接拉起支付。</li> <li>用户支付完成之后，跳转到第三方指定的跳转界面中（如果在传参中没有指定则采用默认方式跳转），之后通过<a href="#_1-4-1-回调接口">回调接口</a>通知第三方回调结果。</li></ol> <h3 id="_4-2-整体交互流程图"><a href="#_4-2-整体交互流程图" class="header-anchor">#</a> 4.2 整体交互流程图</h3> <p><img src="static/picture/paysdk04.b7a06c31.png" alt=""></p> <h3 id="_4-3-细节时序图"><a href="#_4-3-细节时序图" class="header-anchor">#</a> 4.3 细节时序图</h3> <p><img src="static/picture/paysdk05.e073b638.png" alt=""></p> <h3 id="_4-4-获取openid"><a href="#_4-4-获取openid" class="header-anchor">#</a> 4.4 获取openId</h3> <blockquote><p>若第三方已经通过其他方式获取到了openId，比如授权，则无需再调用当前方法去获取，将获取到的openId直接使用即可。</p></blockquote> <p><strong>调用步骤：</strong></p> <p>1、导入opendataapi的aar包</p> <p>请联系小天才同学获取</p> <p>2、通过以下方法获取openId</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xtc<span class="token punctuation">.</span>opendataapi<span class="token punctuation">.</span>contact<span class="token punctuation">.</span></span><span class="token class-name">SendMesToXTC</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xtc<span class="token punctuation">.</span>opendataapi<span class="token punctuation">.</span>opendatamanager<span class="token punctuation">.</span></span><span class="token class-name">IGetOpenIdCallback</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xtc<span class="token punctuation">.</span>opendataapi<span class="token punctuation">.</span>opendatamanager<span class="token punctuation">.</span></span><span class="token class-name">OpenDataApiManager</span></span><span class="token punctuation">;</span>

<span class="token class-name">OpenDataApiManager</span> openDataApiManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpenDataApiManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SendMesToXTC<span class="token punctuation">.</span>Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendMesToXTC<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setAppId</span><span class="token punctuation">(</span><span class="token string">&quot;100078&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
openDataApiManager<span class="token punctuation">.</span><span class="token function">getOpenId</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IGetOpenIdCallback<span class="token punctuation">.</span>Stub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResult</span><span class="token punctuation">(</span><span class="token class-name">String</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> desc<span class="token punctuation">,</span> <span class="token class-name">String</span> openId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span><span class="token string">&quot;the openId: &quot;</span><span class="token operator">+</span>openId<span class="token operator">+</span><span class="token string">&quot;,code :&quot;</span><span class="token operator">+</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>3、异常情况介绍</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 成功
 * */</span>
<span class="token class-name">String</span> <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 接口请求失败
 * */</span>
<span class="token class-name">String</span> <span class="token constant">INTERFACE_REQUEST_FAILED</span> <span class="token operator">=</span> <span class="token string">&quot;-1&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 服务器返回为空
 * */</span>
<span class="token class-name">String</span> <span class="token constant">NULL_DATA</span> <span class="token operator">=</span> <span class="token string">&quot;-2&quot;</span><span class="token punctuation">;</span>

<span class="token comment">/**
 *  其他异常
 * */</span>
<span class="token class-name">String</span> <span class="token constant">OTHER_ERROR</span> <span class="token operator">=</span> <span class="token string">&quot;-3&quot;</span><span class="token punctuation">;</span>

</code></pre></div><p>4、由于openId<strong>一般</strong>生成之后便不会改变（特殊情况见下），小天才这边建议获取之后将<code>openId</code>值缓存到本地后续直接使用以提升性能。另外如果因为某些不可抗力原因（如无网络）获取不到openId时，希望能给用户一个友好的提示让其知道当前的情况。</p> <blockquote><p>特殊情况：手表解除绑定之后重新绑定并选择设置为新手表，只有这种情况openId会发生变化。</p></blockquote> <p>注：要支持获取openId需要<strong>在应用中心升级最新的4.5.50设置版本</strong></p> <h3 id="_4-5-下单接口"><a href="#_4-5-下单接口" class="header-anchor">#</a> 4.5 下单接口</h3> <p>详情见 <a href="#_1-5-网页支付预下单">预下单接口</a></p> <h3 id="_4-6-查询订单"><a href="#_4-6-查询订单" class="header-anchor">#</a> 4.6 查询订单</h3> <p>详情见  <a href="#_1-3-查询订单状态">查询订单状态</a></p> <h3 id="_4-7-金额管控说明"><a href="#_4-7-金额管控说明" class="header-anchor">#</a> 4.7 金额管控说明</h3> <p>​		网页支付会自动接入金额管控的限制，关于金额管控的详细说明见<a href="#六、支付金额管控">支付金额管控</a>。</p> <h2 id="五、聚合码支付"><a href="#五、聚合码支付" class="header-anchor">#</a> 五、聚合码支付</h2> <h3 id="_5-1-说明"><a href="#_5-1-说明" class="header-anchor">#</a> 5.1 说明</h3> <p>​		支付聚合码的码由小天才方生成，并且只能使用微信/支付宝扫才会生效，不能使用浏览器等其他方式扫码。</p> <h3 id="_5-2-前提条件"><a href="#_5-2-前提条件" class="header-anchor">#</a> 5.2 前提条件</h3> <p>​		支付聚合码在满足以下两个条件之后才能正常使用：</p> <blockquote><ol><li>将手表支付SDK版本升级到<strong>1.0.4以上（含1.0.4）</strong>，调整<a href="#_2-4-2-发送请求">SDK手表请求</a>处的入参<code>req.payType</code>为<strong>3</strong>即可自动更换为聚合码。</li> <li>将手表基础应用<strong>升级到2.8.00及以上</strong>。</li></ol></blockquote> <h3 id="_5-2-接入流程"><a href="#_5-2-接入流程" class="header-anchor">#</a> 5.2 接入流程</h3> <blockquote><p>​		对于想要接入聚合码的同学，请根据自己的情况选择下方对应的调整方式。</p></blockquote> <ul><li><p><strong>第一次接入手表支付SDK</strong></p> <p>第一次接入的同学，请在满足<a href="#_5-2-前提条件">前提条件</a>的情况下依照<a href="#二、手表端扫码支付sdk说明">手表支付SDK说明</a>的流程接入即可。</p></li> <li><p><strong>之前已经接入过手表支付SDK</strong></p> <p>已经接入过一次的同学，只要满足<a href="#_5-2-前提条件">前提条件</a>即可，无需做其他改动。</p></li></ul> <h3 id="_5-3-金额管控说明"><a href="#_5-3-金额管控说明" class="header-anchor">#</a> 5.3 金额管控说明</h3> <p>​		聚合码支付会自动接入金额管控的限制，关于金额管控的详细说明见<a href="#六、支付金额管控">支付金额管控</a>。</p> <h2 id="六、支付金额管控"><a href="#六、支付金额管控" class="header-anchor">#</a> 六、支付金额管控</h2> <blockquote><p>​	为了响应国家政策，小天才会对当月消费超过一定金额的手表进行管控，被管控的手表每笔消费都需要家长（爸爸、妈妈或管理员）同意之后方可完成支付，次月重新开始计算（即重置）。</p></blockquote> <p>​		支付管控是小天才方单方面的限制，不需要您做接入或做任何改动，您只需要知道小天才有这样的机制即可。</p> <h3 id="_6-1-触发条件"><a href="#_6-1-触发条件" class="header-anchor">#</a> 6.1 触发条件</h3> <p>​	如果想要触发手表支付金额的管控，那么需要满足下方<strong>三个条件</strong>：</p> <ol><li><p>家长端（<strong>爸爸</strong>、<strong>妈妈</strong>或者<strong>管理员</strong>三者任一角色）的小天才app版本升级到<strong>8.72.0</strong>及以上。</p></li> <li><p>手表<strong>当月消费</strong>（不含正在进行的订单）超过一定金额（<strong>默认200元</strong>）。</p> <ul><li>该金额可以在 <strong>&quot;小天才APP-&gt;更多-&gt;应用管理-&gt;VIP购买记录-&gt;设置（右上角）&quot;</strong> 中进行自定义设置，<strong>默认为200元</strong>。</li></ul> <blockquote><p>该功能需要满足以下条件展示：</p> <ol><li>将手表基础应用<strong>升级到2.8.00及其以上</strong>才会在APP展示，没有此功能的话按照默认的200元限额处理。</li> <li>升级 <strong>支付SDK</strong> 到 <strong>1.0.4</strong> 及以上。</li> <li>升级完成之后重启下APP。</li></ol></blockquote> <ul><li>该模块展示图</li></ul> <p><img src="static/picture/paysdk_jh1.cd7ee60e.jpg" alt="img" style="zoom:50%;"><img src="static/picture/paysdk_jh2.a46a98a7.jpg" alt="img" style="zoom:50%;"><img src="static/picture/paysdk_jh3.f8a084b9.jpg" alt="img" style="zoom:50%;"></p></li> <li><p>使用的是<strong>网页支付</strong>或者<strong>聚合码支付</strong>。</p></li></ol> <h2 id="七、商品名称命名规范"><a href="#七、商品名称命名规范" class="header-anchor">#</a> 七、商品名称命名规范</h2> <h3 id="_7-1-命名规则及参考"><a href="#_7-1-命名规则及参考" class="header-anchor">#</a> 7.1 命名规则及参考</h3> <p>为保障用户能明确知晓付费应用，开发者商品名称命名需采用&quot;应用名_商品名称&quot;的格式，如“智宠学堂_季度VIP”、“英语学院_1个月VIP”</p> <h2 id="八、售后服务规则"><a href="#八、售后服务规则" class="header-anchor">#</a> 八、售后服务规则</h2> <h3 id="_8-1-退款原则"><a href="#_8-1-退款原则" class="header-anchor">#</a> 8.1 退款原则</h3> <p>若为孩子操作付费，付费后一个月内无条件退款。若非孩子付款的退款请求，基于用户沟通协商情况酌情处理。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2022/6/22 下午4:30:24</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="08-service.html" class="prev">
        应用服务号
      </a></span> <span class="next"><a href="03-function.html">
        API开放接口
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="static/js/app.c5cf0902.js" defer=""></script><script src="static/js/2.64c56ba3.js" defer=""></script><script src="static/js/5.7d14a609.js" defer=""></script>
  </body>
</html>
