<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>API开放接口 | 小天才开放平台 | 文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="小天才开放平台,小天才开发者平台,帮助开发者更好地开发平台应用。">
    
    <link rel="preload" href="static/css/0.styles.3e96b5ae.css" as="style"><link rel="preload" href="https://developer.okii.com/docs/assets/js/app.c5cf0902.js" as="script"><link rel="preload" href="https://developer.okii.com/docs/assets/js/2.64c56ba3.js" as="script"><link rel="preload" href="https://developer.okii.com/docs/assets/js/9.f91da2c8.js" as="script"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/10.7dabc864.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/11.a857b413.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/12.b65651e7.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/13.0ec7aaa7.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/14.ae03732c.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/15.bd585f03.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/16.8ce8785d.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/17.83cf954d.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/18.0a544859.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/19.3e8a6e86.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/20.b97b66fb.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/21.e0a445ca.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/22.c6f18896.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/23.bb06cbb4.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/24.3a8f5dc7.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/25.6258f33e.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/26.d995a2f2.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/27.1fadabf2.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/28.0708c0c2.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/29.3ac293a5.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/3.89808b9c.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/30.cd196038.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/31.29284ed9.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/32.6e0fbfcd.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/33.5b4e9fbb.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/34.faf644ab.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/35.d64c3b26.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/36.ffa0bc2d.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/37.4efadb19.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/38.1301eb3d.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/39.765462f8.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/4.40351588.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/40.8ae7b2ef.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/41.b53a935b.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/42.1b8db389.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/43.57d2f36e.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/44.4f42e10b.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/45.49d1f12c.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/46.b00351d5.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/47.ee33eed7.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/48.d593d13f.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/49.90697f7e.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/5.7d14a609.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/50.eb9d6e79.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/6.145dd442.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/7.d2b7988b.js"><link rel="prefetch" href="https://developer.okii.com/docs/assets/js/8.63a01d72.js">
    <link rel="stylesheet" href="static/css/0.styles.3e96b5ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewbox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="docs.html" class="home-link router-link-active"><!----> <span class="site-name">小天才开放平台 | 文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  回到首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="apply.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  申请入驻
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="contact.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  联系我们
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="03-function1.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  回到首页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="apply.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  申请入驻
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="contact.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  联系我们
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="03-function1.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>应用发布</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="01-shelf.html" class="sidebar-link">上架流程</a></li><li><a href="03-version.html" class="sidebar-link">版本提供</a></li><li><a href="02-resource.html" class="sidebar-link">审核规范</a></li><li><a href="06-publish.html" class="sidebar-link">市场监控标准</a></li><li><a href="04-principle.html" class="sidebar-link">应用违规处理（试运行）</a></li><li><a href="05-notice.html" class="sidebar-link">侵权投诉处理流程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>开发指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="00-model.html" class="sidebar-link">开放机型</a></li><li><a href="01-setting.html" class="sidebar-link">基础配置</a></li><li><a href="02-permission.html" class="sidebar-link">应用权限</a></li><li><a href="09-account.html" class="sidebar-link">账号系统</a></li><li><a href="08-service.html" class="sidebar-link">应用服务号</a></li><li><a href="10-paysdk.html" class="sidebar-link">支付 SDK 说明</a></li><li><a href="" aria-current="page" class="active sidebar-link">API开放接口</a></li><li><a href="04-optimization.html" class="sidebar-link">注意事项</a></li><li><a href="06-problem.html" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>设计指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="interaction.html" class="sidebar-link">交互设计</a></li><li><a href="vision.html" class="sidebar-link">视觉设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>快应用接入</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="01-guide.html" class="sidebar-link">快应用接入</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="api开放接口"><a href="#api开放接口" class="header-anchor">#</a> API开放接口</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-输入法">1. 输入法</a></li><li><a href="#_2-分享功能">2. 分享功能</a><ul><li><a href="#_2-1-分享能力获取">2.1 分享能力获取</a></li><li><a href="#_2-2-检测版本是否支持">2.2 检测版本是否支持</a></li><li><a href="#_2-3-分享指定内容类型">2.3 分享指定内容类型</a></li><li><a href="#_2-4-分享回调">2.4 分享回调</a></li><li><a href="#_2-5-分享指定渠道">2.5 分享指定渠道</a></li><li><a href="#_2-6-注意事项">2.6 注意事项</a></li><li><a href="#_2-7-sdk下载">2.7 SDK下载</a></li></ul></li><li><a href="#_3-步数获取">3. 步数获取</a></li><li><a href="#_4-z6-翻盖翻起适配">4. Z6 翻盖翻起适配</a></li><li><a href="#_5-通知栏适配">5. 通知栏适配</a></li><li><a href="#_6-音乐通知栏">6. 音乐通知栏</a></li><li><a href="#_6-webview网页功能">6.Webview网页功能</a></li><li><a href="#_7-相机拍照-相册获取图片功能">7.相机拍照，相册获取图片功能</a></li><li><a href="#_8-demo下载">8.demo下载</a></li><li><a href="#_9-待支持功能">9. 待支持功能</a></li></ul></div><p></p> <h2 id="_1-输入法"><a href="#_1-输入法" class="header-anchor">#</a> 1. 输入法</h2> <p>支持手写、语音、数字、字符。</p> <ul><li>初始化设置</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//手写默认：110;语音：111;数字：112;字符113</span>
editText<span class="token punctuation">.</span><span class="token function">setInputType</span><span class="token punctuation">(</span><span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取输入的文本</span>
editText<span class="token punctuation">.</span><span class="token function">addTextChangedListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TextWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>代码调起输入法</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">InputMethodManager</span> imm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">InputMethodManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">INPUT_METHOD_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
imm<span class="token punctuation">.</span><span class="token function">toggleSoftInput</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">InputMethodManager</span><span class="token punctuation">.</span><span class="token constant">HIDE_NOT_ALWAYS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_2-分享功能"><a href="#_2-分享功能" class="header-anchor">#</a> 2. 分享功能</h2> <h3 id="_2-1-分享能力获取"><a href="#_2-1-分享能力获取" class="header-anchor">#</a> 2.1 分享能力获取</h3> <ul><li>找小天才对接人员申请支持分享的AppKey。</li> <li>引入sdk，具体见 2.7 SDK 下载</li></ul> <h3 id="_2-2-检测版本是否支持"><a href="#_2-2-检测版本是否支持" class="header-anchor">#</a> 2.2 检测版本是否支持</h3> <p>如果有特殊需求可以先行检测再分享，如果没有则不需要执行，在SDK中针对版本不支持的情况会默认弹一个Toast,提示当前版本不支持分享到XX。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//查询是否支持分享到微聊</span>
<span class="token keyword">boolean</span> isSupport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShareMessageManager</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkBaseVersion</span><span class="token punctuation">(</span><span class="token class-name">Scene</span><span class="token punctuation">.</span><span class="token constant">TYPE_CHAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//查询是否支持分享到好友圈</span>
<span class="token keyword">boolean</span> isSupport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShareMessageManager</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkBaseVersion</span><span class="token punctuation">(</span><span class="token class-name">Scene</span><span class="token punctuation">.</span><span class="token constant">TYPE_MOMENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-3-分享指定内容类型"><a href="#_2-3-分享指定内容类型" class="header-anchor">#</a> 2.3 分享指定内容类型</h3> <ul><li>分享文本类型</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//第一步：创建XTCTextObject对象，并设置text属性为要分享的文本内容</span>
<span class="token class-name">XTCTextObject</span> xtcTextObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XTCTextObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xtcTextObject<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">&quot;来自测试程序的分享&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第二步：创建XTCShareMessage对象，并将shareObject属性设置为xtcTextObject对象</span>
<span class="token class-name">XTCShareMessage</span> xtcShareMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XTCShareMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xtcShareMessage<span class="token punctuation">.</span><span class="token function">setShareObject</span><span class="token punctuation">(</span>xtcTextObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第三步：创建SendMessageToXTC.Request对象，并设置</span>
<span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>xtcShareMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第四步：创建ShareMessageManagr对象，调用sendRequestToXTC方法，传入SendMessageToXTC.Request对象和AppKey</span>
<span class="token keyword">new</span> <span class="token class-name">ShareMessageManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendRequestToXTC</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;appkey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>分享图片类型</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//第一步：创建XTCImageObject 对象，并设置bitmap属性为要分享的图片</span>
<span class="token class-name">XTCImageObject</span> xtcImageObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XTCImageObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xtcImageObject<span class="token punctuation">.</span><span class="token function">setBitmap</span><span class="token punctuation">(</span><span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>img_show<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//如果图片在公共目录，可以直接设置图片路径即可</span>
xtcImageObject<span class="token punctuation">.</span><span class="token function">setImagePath</span><span class="token punctuation">(</span>“filePath”<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第二步：创建XTCShareMessage对象，并将shareObject属性设置为xtcTextObject对象</span>
<span class="token class-name">XTCShareMessage</span> xtcShareMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XTCShareMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xtcShareMessage<span class="token punctuation">.</span><span class="token function">setShareObject</span><span class="token punctuation">(</span>xtcImageObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第三步：创建SendMessageToXTC.Request对象，并设置message属性为xtcShareMessage</span>
<span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>xtcShareMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置跳转参数，设置为1为分享成功停留到微聊或者好友圈，设置为0或者不设置分享成功会返回原分享界面</span>

<span class="token comment">//第四步：创建ShareMessageManagr对象，调用sendRequestToXTC方法，传入SendMessageToXTC.Request对象和AppKey</span>
<span class="token keyword">new</span> <span class="token class-name">ShareMessageManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendRequestToXTC</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;appKey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>分享程序类型（图文类型）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//第一步：创建XTCAppExtendObject对象</span>
<span class="token class-name">XTCAppExtendObject</span> xtcAppExtendObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XTCAppExtendObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置点击分享的内容启动的页面</span>
xtcAppExtendObject<span class="token punctuation">.</span><span class="token function">setStartActivity</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置分享的扩展信息，点击分享的内容会将该扩展信息带入跳转的页面</span>
xtcAppExtendObject<span class="token punctuation">.</span><span class="token function">setExtInfo</span><span class="token punctuation">(</span><span class="token string">&quot;ExtendInfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第二步：创建XTCShareMessage对象，并将shareObject属性设置为xtcTextObject对象</span>
<span class="token class-name">XTCShareMessage</span> xtcShareMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XTCShareMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xtcShareMessage<span class="token punctuation">.</span><span class="token function">setShareObject</span><span class="token punctuation">(</span>xtcAppExtendObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置图片</span>
xtcShareMessage<span class="token punctuation">.</span><span class="token function">setThumbImage</span><span class="token punctuation">(</span><span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>img_app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//设置文本</span>
xtcShareMessage<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">&quot;这是一条图文分享信息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第三步：创建SendMessageToXTC.Request对象，并设置message属性为xtcShareMessage</span>
<span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>xtcShareMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置跳转参数，设置为1为分享成功停留到微聊或者好友圈，设置为0或者不设置分享成功会返回原分享界面</span>

<span class="token comment">//第四步：创建ShareMessageManagr对象，调用sendRequestToXTC方法，传入SendMessageToXTC.Request对象和AppKey</span>
<span class="token keyword">new</span> <span class="token class-name">ShareMessageManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendRequestToXTC</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;appKey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-4-分享回调"><a href="#_2-4-分享回调" class="header-anchor">#</a> 2.4 分享回调</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//第一步：在点击分享的页面实现IResponseCallback接口</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token keyword">implements</span> <span class="token class-name">IResponseCallback</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

<span class="token comment">//第二步：在onCreate、onNewIntent方法中处理回调</span>
<span class="token keyword">private</span> <span class="token class-name">IXTCCallback</span> xtcCallback<span class="token punctuation">;</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//处理回调</span>
    xtcCallback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XTCCallbackImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xtcCallback<span class="token punctuation">.</span><span class="token function">handleIntent</span><span class="token punctuation">(</span><span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onNewIntent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onNewIntent</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setIntent</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//处理回调</span>
    xtcCallback<span class="token punctuation">.</span><span class="token function">handleIntent</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//第三步：实现onResp和onReq方法</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResp</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isSuccess<span class="token punctuation">,</span> <span class="token class-name">BaseResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//to-do</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReq</span><span class="token punctuation">(</span><span class="token class-name">ShowMessageFromXTC<span class="token punctuation">.</span>Request</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//to-do</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>onResp方法</li></ul> <p>该方法是用于点击分享之后，分享结果信息的回调。</p> <table><thead><tr><th>字段</th> <th>说明</th></tr></thead> <tbody><tr><td>isSuccess</td> <td>是否分享成功</td></tr> <tr><td>response.getCode()</td> <td>回调状态码，具体可以通过BaseResponse.Code进行判断</td></tr> <tr><td>response.getErrorDesc()</td> <td>状态码的描述</td></tr> <tr><td>response.getConversationId()</td> <td>分享的会话ID，好友圈为-1，其是将微聊的会话ID进行加密后返回的</td></tr> <tr><td>response.getTransaction()</td> <td>标识唯一分享</td></tr></tbody></table> <ul><li>onReq方法</li></ul> <p>该方法是用于在微聊或好友圈点击分享的程序信息后会跳转到指定页面的回调。</p> <table><thead><tr><th>字段</th> <th>说明</th></tr></thead> <tbody><tr><td>request.getExtInfo()</td> <td>XTCAppExtendObject对象设置的extInfo属性</td></tr> <tr><td>request.getScene()</td> <td>分享到的场景，scene.getType()判断场景类型，Scene.TYPE_CHAT是微聊，Scene.TYPE_MOMENT是好友圈</td></tr> <tr><td>request.getTransaction()</td> <td>标识唯一分享</td></tr></tbody></table> <h3 id="_2-5-分享指定渠道"><a href="#_2-5-分享指定渠道" class="header-anchor">#</a> 2.5 分享指定渠道</h3> <p><img src="static/picture/share.f46c436e.png" alt="image"></p> <p>除上述点击分享后调到一个渠道选择页面（如上图）外，还可以跳过渠道选择页面直接分享到指定渠道，详细方法如下：</p> <ul><li>分享到微聊</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//第一步：创建场景</span>
<span class="token class-name">Chat</span> chat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//允许显示的会话，如果不设置默认为好友和好友群</span>
chat<span class="token punctuation">.</span><span class="token function">setFriendType</span><span class="token punctuation">(</span><span class="token class-name">Chat</span><span class="token punctuation">.</span><span class="token constant">FRIEND</span><span class="token operator">|</span><span class="token class-name">Chat</span><span class="token punctuation">.</span><span class="token constant">FRIEND_GROUP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//需要过滤的好友，传入coversitionId列表（conversitionId来自于onReq方法）</span>
chat<span class="token punctuation">.</span><span class="token function">setFilterConversationList</span><span class="token punctuation">(</span>filterConversationList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//过滤机型</span>
chat<span class="token punctuation">.</span><span class="token function">setFilterModeList</span><span class="token punctuation">(</span>filterModeList<span class="token punctuation">)</span>
<span class="token comment">//点击过滤的好友需要Toast的文本内容</span>
chat<span class="token punctuation">.</span><span class="token function">setFilterTip</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>share_error_limit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第二步：将场景设置到SendMessageToXTC.Request对象中</span>
<span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setScene</span><span class="token punctuation">(</span>chat<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>分享到好友圈</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//第一步：创建场景</span>
<span class="token class-name">Moment</span> moment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//第二步：将场景设置到SendMessageToXTC.Request对象中</span>
<span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendMessageToXTC<span class="token punctuation">.</span>Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setScene</span><span class="token punctuation">(</span>moment <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-6-注意事项"><a href="#_2-6-注意事项" class="header-anchor">#</a> 2.6 注意事项</h3> <ul><li><p><code>new ShareMessageManager(context)</code>，该 context 必须为 Activity。</p></li> <li><p>应用图标尽量使用8位图标，否则压缩之后的图标太大，占用较多服务器资源。</p></li> <li><p>分享和跳转界面，都需要加 <code>exproed = ture</code> 标签。</p></li> <li><p>如果你的 APP 开启了混淆，请配置一下分享相关的类不混淆，否则会导致分享失败。</p></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">-</span>keep <span class="token keyword">class</span>  com<span class="token punctuation">.</span>xtc<span class="token punctuation">.</span>shareapi<span class="token punctuation">.</span>*<span class="token operator">*</span><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-7-sdk下载"><a href="#_2-7-sdk下载" class="header-anchor">#</a> 2.7 SDK下载</h3> <p>请联系小天才获取。</p> <h2 id="_3-步数获取"><a href="#_3-步数获取" class="header-anchor">#</a> 3. 步数获取</h2> <ol><li>首先，需要在AndroidManifest中声明步数权限：</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;com.xtc.motion.permission.READ_MOTION_STATE&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><ol start="2"><li><p>由于旧版本没有自定义权限，可直接获取，所以为了适配旧版本，需要先调用一次获取步数的方法（代码示例<code>getMotionStep()</code>方法，需要<code>try catch</code>，防止崩溃），</p> <ul><li>如果未获取到，则去申请步数权限；申请<strong>自定义的读取步数的权限</strong>代码参考下面的示例。</li> <li>如果能正常获取到步数，就直接用获取到的步数执行处理逻辑。</li></ul></li> <li><p>重写 <code>onRequestPermissionsResult</code> 方法用于接收授权结果。调用弹出授权框后，</p> <ul><li>如果用户点击同意授权，则<code>onRequestPermissionsResult</code>会回调到授权成功的结果。可以调用方法获取步数；</li> <li>如果用户未同意，<code>onRequestPermissionsResult</code>会回调到授权失败，这时获取不到步数，需要自己进行处理。</li></ul></li></ol> <p>代码示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token comment">//授权相关的CODE</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">PERMISSION_CODE</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    
    <span class="token comment">//读取步数权限</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">READ_MOTION_STATE</span> <span class="token operator">=</span> <span class="token string">&quot;com.xtc.motion.permission.READ_MOTION_STATE&quot;</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>
            <span class="token constant">READ_MOTION_STATE</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initStepData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> step <span class="token operator">=</span> <span class="token function">getMotionStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>step <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//step为-1，代表未获取到步数，需要申请步数权限</span>
            <span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> <span class="token constant">PERMISSION_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token comment">//不为-1则说明已经获取到了步数，执行步数处理逻辑</span>
    		todo doYourSelfBussiness method
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//Activiity申请权限的回调</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> <span class="token constant">PERMISSION_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>grantResults<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> grantResults<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">PERMISSION_GRANTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//同意授权则调用获取步数的方法</span>
                <span class="token function">getMotionStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//如果用户不同意授权，需要自己做处理</span>
                todo doYourSelfDealUserUnauthorized method
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//获取运动步数</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">getMotionStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ContentResolver</span> contentResolver <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parseint</span><span class="token punctuation">(</span><span class="token string">&quot;content://com.xtc.motion/step&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> step <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            cursor <span class="token operator">=</span> contentResolver<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                step <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span><span class="token string">&quot;step&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">LogUtil</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span><span class="token string">&quot;getMotionStep :&quot;</span><span class="token operator">+</span>step<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span><span class="token string">&quot;getMotionStep&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> step<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-z6-翻盖翻起适配"><a href="#_4-z6-翻盖翻起适配" class="header-anchor">#</a> 4. Z6 翻盖翻起适配</h2> <p>支持第三方应用监听手表翻盖的状态。</p> <ul><li>初始状态</li></ul> <p>使用<code>android.os.SystemProperties</code>读取 <code>persist.sys.hall.opened</code>值；true为打开状态</p> <ul><li>实时监听</li></ul> <table><thead><tr><th style="text-align:center;">功能</th> <th style="text-align:center;">最新版本统一后的key值</th> <th style="text-align:center;">Z6老版本key值</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">关闭</td> <td style="text-align:center;">1004</td> <td style="text-align:center;">287</td> <td style="text-align:center;"><strong>Z6</strong> 从<code>1.5.5</code>系统版本开始都是统一成<code>1004</code>，<strong>Z6</strong>之前的版本是<code>287</code>，<strong>Z6巅峰版</strong>一直都是<code>1004</code></td></tr> <tr><td style="text-align:center;">打开</td> <td style="text-align:center;">1003</td> <td style="text-align:center;">288</td> <td style="text-align:center;"><strong>Z6</strong> 从<code>1.5.5</code>系统版本开始都是统一成<code>1003</code>，<strong>Z6</strong>之前的版本是<code>288</code>，<strong>Z6巅峰版</strong>一直都是<code>1003</code></td></tr></tbody></table> <blockquote><p>总之一句话：  第三方的版本，使用<code>1004和1003</code>来判断即可！</p></blockquote> <p>因为Z6手表的1.5.5系统版本已经发布一年多了，后续接入进来的第三方不会发布到该版本之前的版本。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//实时监听</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onKeyDown</span><span class="token punctuation">(</span><span class="token keyword">int</span> keyCode<span class="token punctuation">,</span> <span class="token class-name">KeyEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token number">1004</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//关闭</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token number">1003</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//打开</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onKeyDown</span><span class="token punctuation">(</span>keyCode<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-通知栏适配"><a href="#_5-通知栏适配" class="header-anchor">#</a> 5. 通知栏适配</h2> <blockquote><p>不管是展讯平台还是高通平台，第三方的都直接 copy 下面的代码稍作修改，然后发通知即可!!</p></blockquote> <blockquote><p><strong>注意事项：系统做了定制化，8.0启动用于启动前台服务的通知栏不会展示出来。</strong></p> <p><strong>如果是想展示音乐通知栏的话，另外按照下面的音乐通知栏代码生成，别和启动前台服务的通知栏和在一起。意思是：如果你用前台服务播放音乐，然后想展示音乐通知栏，那么就弄两个通知栏，</strong></p> <p><strong>一个通知栏用于启动前台服务并不会展示，另外一个音乐通知栏展示出来控制音乐播放。</strong></p></blockquote> <ul><li>展示通知</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 这句话得调用，别漏了</span>
<span class="token class-name">NotificationHelper</span><span class="token punctuation">.</span><span class="token function">createDefaultChannel</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">NotificationManager</span> manager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NotificationManager</span><span class="token punctuation">)</span> <span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">NOTIFICATION_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Notification</span> notification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NotificationCompat<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">NotificationHelper</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_CHANNEL_ID</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setContentTitle</span><span class="token punctuation">(</span><span class="token string">&quot;小天才通知Title&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setContentText</span><span class="token punctuation">(</span><span class="token string">&quot;小天才通知Content&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setTicker</span><span class="token punctuation">(</span><span class="token string">&quot;一条新消息&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setWhen</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setSmallIcon</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>notification<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setLargeIcon</span><span class="token punctuation">(</span><span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>notification<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
manager<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> notification<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>创建 channel</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotificationHelper</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_CHANNEL_ID</span> <span class="token operator">=</span> <span class="token string">&quot;1024&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FROEGROUND_SERVICE_CHANNEL_ID</span> <span class="token operator">=</span> <span class="token string">&quot;1025&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 默认渠道
     * @param context
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createDefaultChannel</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&gt;=</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">NotificationChannel</span> chan1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NotificationChannel</span><span class="token punctuation">(</span><span class="token constant">DEFAULT_CHANNEL_ID</span><span class="token punctuation">,</span><span class="token string">&quot;notification&quot;</span><span class="token punctuation">,</span> <span class="token class-name">NotificationManager</span><span class="token punctuation">.</span><span class="token constant">IMPORTANCE_HIGH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">NotificationManager</span> notificationManager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NotificationManager</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>
                    <span class="token constant">NOTIFICATION_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>notificationManager <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                notificationManager<span class="token punctuation">.</span><span class="token function">createNotificationChannel</span><span class="token punctuation">(</span>chan1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-音乐通知栏"><a href="#_6-音乐通知栏" class="header-anchor">#</a> 6. 音乐通知栏</h2> <p><strong>为了更好的音乐通知体验,新版本桌面统一了音乐通知的显示,将在表盘下拉和锁屏统一显示</strong></p> <ol><li>快捷显示</li></ol> <p><img src="static/picture/func1.07d8d185.png" alt="快捷显示"></p> <ol start="2"><li>锁屏显示</li></ol> <p><img src="static/picture/func2.be7cf6ce.png" alt="锁屏显示"></p> <p><strong>第3方需要适配音乐通知 sdk (联系小天才获取sdk和demo)</strong></p> <p><strong>Note:未适配的音乐类应用,新版本将无法弹出通知</strong></p> <h4 id="集成音乐通知-sdk"><a href="#集成音乐通知-sdk" class="header-anchor">#</a> 集成音乐通知 sdk</h4> <p>播放音乐的时候，支持在音乐控件/通知栏显示当前的信息,以及快捷上一首/下一首/暂停/播放。</p> <ol><li>添加音乐sdk依赖</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        flatDir <span class="token punctuation">{</span>
            dirs <span class="token string">'libs'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
dependencies <span class="token punctuation">{</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token string">'xtc_music_notification_1.0.1'</span><span class="token punctuation">,</span> ext<span class="token punctuation">:</span> <span class="token string">'aar'</span><span class="token punctuation">)</span> <span class="token comment">// xtc_music_notification.aar 文件放入项目 libs/ 目录下</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>如果是前台通知,需要先设置前台进程保活(前台通知不会显示)</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/* 前台进程保活,这个通知不会显示 */</span>
<span class="token class-name">Notification</span> notification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startForeground</span><span class="token punctuation">(</span><span class="token constant">FOREGROUND_ID</span><span class="token punctuation">,</span> notification<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>音乐通知构建</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">MusicNotification</span> musicNotification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MusicNotification<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">layout</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>notification_remote_view<span class="token punctuation">)</span><span class="token comment">/*在低版本上显示的通知的 layout 文件id ,为了兼容D3机型,根布局使用 RelativeLayout*/</span>
    <span class="token punctuation">.</span><span class="token function">tvSongName</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_song_name<span class="token punctuation">,</span><span class="token comment">/* 通知中的 &quot;歌曲名&quot; 控件id, 必须是一个 TextView */</span>
            <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getBroadcast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">REQUEST_CODE_SKIP_TO_SPLASH</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">NotificationMusicReceiver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token constant">ACTION_NOTIFICATION_START_APP</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token constant">FLAG_UPDATE_CURRENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">/*点击歌曲名称,触发 Intent*/</span>

    <span class="token punctuation">.</span><span class="token function">ivPrevious</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>iv_previous<span class="token punctuation">,</span> <span class="token comment">/* 通知中的 &quot;上一曲&quot; 控件id, 必须是一个 ImageView */</span>
            <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getBroadcast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">REQUEST_CODE_PREVIOUS</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">NotificationMusicReceiver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token constant">ACTION_NOTIFICATION_PREVIOUS</span><span class="token punctuation">)</span>
                    <span class="token punctuation">,</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token constant">FLAG_UPDATE_CURRENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">/*点击 &quot;上一曲&quot;,触发 Intent*/</span>

    <span class="token punctuation">.</span><span class="token function">ivNext</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>iv_next<span class="token punctuation">,</span> <span class="token comment">/* 通知中的 &quot;下一曲&quot; 控件id, 必须是一个 ImageView */</span>
            <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getBroadcast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">REQUEST_CODE_NEXT</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">NotificationMusicReceiver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token constant">ACTION_NOTIFICATION_NEXT</span><span class="token punctuation">)</span>
                    <span class="token punctuation">,</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token constant">FLAG_UPDATE_CURRENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">/* 点击 &quot;下一曲&quot;,触发 Intent */</span>

    <span class="token punctuation">.</span><span class="token function">playPause</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>iv_play_pause<span class="token punctuation">,</span> <span class="token comment">/* 通知中的 &quot;播放/暂停&quot; 控件id, 必须是一个 ImageView */</span>
            <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getBroadcast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">REQUEST_CODE_PLAY_PAUSE</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">NotificationMusicReceiver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token constant">ACTION_NOTIFICATION_PLAY_PAUSE</span><span class="token punctuation">)</span>
                    <span class="token punctuation">,</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token constant">FLAG_UPDATE_CURRENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">/* 点击 &quot;播放/暂停&quot;, 触发 Intent */</span>
    <span class="token punctuation">.</span><span class="token function">playPauseRes</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>selector_action_pause_song<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>selector_action_play_song<span class="token punctuation">)</span><span class="token comment">/* &quot;播放/暂停&quot;状态 显示的资源 id */</span>

    <span class="token punctuation">.</span><span class="token function">tvSinger</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_singer_name<span class="token punctuation">)</span><span class="token comment">/* 通知中的 &quot;歌手名&quot; 控件id, 必须是一个 TextView , 可以没有 */</span>

    <span class="token punctuation">.</span><span class="token function">contentIntent</span><span class="token punctuation">(</span><span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token constant">FLAG_UPDATE_CURRENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">/* 点击通知触发 */</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 1.0.1</span>
	<span class="token class-name">RemoteViews</span> remoteMusicViews <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getRemoteMusicViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*如果要有其他的显示,也可以直接用 RemoteViews 的 API*/</span>
	remoteMusicViews<span class="token punctuation">.</span><span class="token function">setOnClickPendingIntent</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv_close<span class="token punctuation">,</span><span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getBroadcast</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">NotificationMusicReceiver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token constant">ACTION_CANCEL_NOTIFICATION</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token constant">FLAG_CANCEL_CURRENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* 取消的按钮,音乐通知规范要求要有这个*/</span>
</code></pre></div><ol start="4"><li>音乐通知发送与更新</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 播放时 的显示</span>
musicNotification<span class="token punctuation">.</span><span class="token function">showSongName</span><span class="token punctuation">(</span>songName<span class="token punctuation">)</span><span class="token comment">/*歌曲名*/</span>
    <span class="token punctuation">.</span><span class="token function">showSinger</span><span class="token punctuation">(</span>singer<span class="token punctuation">)</span><span class="token comment">/*歌手*/</span>
    <span class="token punctuation">.</span><span class="token function">showAlbumCover</span><span class="token punctuation">(</span>albumCoverUrl<span class="token punctuation">)</span><span class="token comment">/*新版本的锁屏支持,显示专辑图片,这里传入图片的 url*/</span>
    <span class="token punctuation">.</span><span class="token function">showPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">/*当前为播放状态*/</span>
    <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*发送通知*/</span>
<span class="token comment">// 暂停时 的显示</span>
musicNotification<span class="token punctuation">.</span><span class="token function">showPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*显示暂停的音乐通知,为了配合系统进程策略,避免异常,如果之后 5min 没有调用 showPlay(),会自动取消通知显示*/</span>
<span class="token comment">// 取消音乐通知</span>
musicNotification<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*取消音乐通知*/</span>
</code></pre></div><h4 id="适配后的自测"><a href="#适配后的自测" class="header-anchor">#</a> 适配后的自测</h4> <table><thead><tr><th>手表机型\桌面版本</th> <th>安装Launcher_old.apk</th> <th>安装launcher_new.apk</th></tr></thead> <tbody><tr><td>Z3/Z5/Z6/Z6巅峰版/Z7<strong>任选一种</strong></td> <td>1.  通知栏显示音乐通知,点击音乐控制按钮,功能正常</td> <td>1.通知栏不显示音乐通知 <br>2.表盘界面下拉,显示音乐控件,点击音乐控制按钮,功能正常  <br>3.不插电状态下,音乐播放过程中,锁屏显示音乐通知</td></tr> <tr><td>D3</td> <td>同上↑</td> <td>暂无需验证</td></tr></tbody></table> <h2 id="_6-webview网页功能"><a href="#_6-webview网页功能" class="header-anchor">#</a> 6.Webview网页功能</h2> <p>提供支持在手表上打开Web网页的功能和web网页与手表交互一些的能力。</p> <p><a href="javascript:;" target="_blank" rel="noopener noreferrer">webSDK<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_7-相机拍照-相册获取图片功能"><a href="#_7-相机拍照-相册获取图片功能" class="header-anchor">#</a> 7.相机拍照，相册获取图片功能</h2> <p><a href="javascript:;" target="_blank" rel="noopener noreferrer">通用接口调用拍照文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_8-demo下载"><a href="#_8-demo下载" class="header-anchor">#</a> 8.demo下载</h2> <p>请联系小天才获取。</p> <h2 id="_9-待支持功能"><a href="#_9-待支持功能" class="header-anchor">#</a> 9. 待支持功能</h2> <ul><li>推送</li> <li>定位</li> <li>小视频录制</li> <li>做活动消耗积分</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021/9/3 上午10:12:39</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="10-paysdk.html" class="prev">
        支付 SDK 说明
      </a></span> <span class="next"><a href="04-optimization.html">
        注意事项
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="static/js/app.c5cf0902.js" defer=""></script><script src="static/js/2.64c56ba3.js" defer=""></script><script src="static/js/9.f91da2c8.js" defer=""></script>
  </body>
</html>
