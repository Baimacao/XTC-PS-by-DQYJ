"use strict";var protocol=location.protocol,hostname=window.location.hostname,domain=protocol+"//developer.module.okii.com/devplatform",lang=sessionStorage.getItem("lang")||"zh-CN",$applyForm=$("#applyForm"),$language=$("#language"),$dialog=(!sessionStorage.getItem("firstBrowse")&&-1<hostname.indexOf("imoo.com")&&(lang="en",$language.find('[value="en"]').prop("selected",!0),sessionStorage.setItem("firstBrowse","1")),-1<["developer.okii.com","developer.imoo.com"].indexOf(hostname)&&(domain=protocol+"//"+hostname+"/devplatform"),function(e,a){e=e?"text-success":"text-danger";$("#modal").find(".js-msg").html(a).removeClass("text-success text-danger").addClass(e),$("#modal").modal("show")}),keys={app_intro:"App's brief introduction which plans to access",app_intro_required:"Please input the App's brief introduction",app_intro_help:"Fill in the App's brief introduction which plans to access, more than 20 words, to let us understand your products more.",contact_tel_required:"Please input the contact person's phone no.",contact_mailbox_required:"Please input the contact person's e-mail",contact_mailbox:"Contact person's e-mail"},jsVars={select:"请选择",img_type_validate:"图片格式必须是png,jpg,jpeg中的一种",img_size_validate:"照片尺寸不能超过20M",upload_error:"上传出错了",validate_error:"请把必要信息填写完整，谢谢您的配合与支持！",developer_validate:"若您已阅读并同意该协议，请勾选此选项.",commit_tip:"提交申请成功，我们会尽快处理完及时通知到您！",server_error:"服务异常，请重试或者联系我们!",company_name_required:"请输入公司名称",company_name_max:"最多50个字符",industry_required:"请选择所属行业",industry_submenu_required:"请选择所属行业的子行业",app_name_required:"请输入应用名称",app_name_max:"最多20个字符",app_intro_required:"请输入应用简介",app_intro_max:"最多500个字符",app_intro_min:"最少20字符",contact_required:"请输入联系人的姓名",contact_max:"最多10个字符",contact_tel_min:"至少输入4位字符",contact_tel_max:"最多20位字符",contact_tel_required:"请输入联系人的电话号码",contact_mailbox_required:"请输入联系人的电子邮箱",contact_mailbox_format:" 邮箱格式不正确"},main={validator:!1,init:function(){$(document).ready(function(){var a,e={key:"productTypes"};"en"===lang&&(e.key="productTypes_international"),main.getResources(e,function(e){a=JSON.parse(e.v),main.initRenderProductType(a,$("#productTypes"))}),main.renderI18n(lang),main.controlIndustry(),main.loopObserve(main.config.observeList),main.validator=$applyForm.validate(main.config.validateOption),main.eventHandle()})},config:{observeList:[{el:"company",length:50},{el:"appName",length:20},{el:"appDesc",length:500},{el:"contact",length:10},{el:"nativeAppName",length:20}],validateOption:{submitHandler:function(){},onfocusout:!1,focusInvalid:!0,focusCleanup:!0,errorPlacement:function(e,a){e.addClass("invalid-feedback"),a.next().hide(),e.appendTo(a.parent())},rules:{company:{required:!0,maxlength:50},industry:{required:!0},industrySubmenu:{required:!0},appName:{required:!0,maxlength:20},appDesc:{required:!0,maxlength:500,minlength:20},contact:{required:!0,maxlength:10},phone:{required:!0,minlength:4,maxlength:20},email:{required:!0,email:!0}},messages:{company:{required:jsVars.company_name_required,maxlength:jsVars.company_name_max},industry:{required:jsVars.industry_required},industrySubmenu:{required:jsVars.industry_submenu_required},appName:{required:jsVars.app_name_required,maxlength:jsVars.app_name_max},appDesc:{required:jsVars.app_intro_required,maxlength:jsVars.app_intro_max,minlength:jsVars.app_intro_min},contact:{required:jsVars.contact_required,maxlength:jsVars.contact_max},phone:{minlength:jsVars.contact_tel_min,maxlength:jsVars.contact_tel_max,required:jsVars.contact_tel_required},email:{required:jsVars.contact_mailbox_required,email:jsVars.contact_mailbox_format}}}},eventHandle(){$(document).ready(function(){$language.on("change",function(){var e=$(this);lang=e.find(":selected").val(),sessionStorage.setItem("lang",lang),window.location.reload()}),$applyForm.on("change","#industry",function(){var e=$(this).val();e?main.getResources({key:"industryChildren_"+e},function(e){e=JSON.parse(e.v);main.initRenderCategory(e,$("#industrySubmenu"),!0)}):main.initRenderCategory([{label:"请选择",value:""}],$("#industrySubmenu"),!0)}).on("click","#commitBtn",function(){var e;main.validator.form()?(e=main.getFormData(),$.ajax({type:"post",url:domain+"/develop/insert",dataType:"JSON",headers:{"Content-Type":"application/json"},data:JSON.stringify(e),success:function(e){var a=!1,n="",n=e&&"000001"===e.code?(document.getElementById("applyForm").reset(),main.validator.resetForm(),a=!0,jsVars.commit_tip):(a=!1,e.desc);$dialog(a,n),setTimeout(function(){window.location.reload(),localStorage.clear()},2500)},error:function(){$dialog(!1,jsVars.server_error)}})):$dialog(!1,jsVars.validate_error)})})},getResources:function(e,a){$.ajax({type:"get",url:domain+"/constant/getByKey",headers:{"Content-Type":"application/json"},data:e,success:function(e){a&&a(e.data)},error:function(){}})},initRenderCategory:function(e,a,n){var t="";n||(t+='<option value="" selected>'+jsVars.select+"</option>"),$.each(e,function(e,a){t+='<option value="'+a.value+'"  >'+a.label+"</option>"}),a.html(t)},initRenderProductType:function(e,a){var n="";$.each(e,function(e,a){n+=0!==e?'<div class="form-check col-md-4 col-sm-3"><input  type="radio" name="gridRadios" id="pro'+e+'" value="'+a.value+'"  required><label class="form-check-label" for="pro'+e+'">&nbsp;'+a.desc+"</label></div>":'<div class="form-check col-md-4 col-sm-4  "><input  type="radio" name="gridRadios" id="pro'+e+'" value="'+a.value+'"  checked required><label class="form-check-label" for="pro'+e+'">&nbsp;'+a.desc+"</label></div>"}),a.html(n)},observeInput:function(e,t){$("#"+e).on("input",function(){var e=$(this),a=e.val()&&e.val().length,n=e.next();n.is(":hidden")&&n.show(),a<=t&&e.parent().parent().find(".input-group-text").text(t-a+"/"+t)})},loopObserve:function(e){$.each(e,function(e,a){main.observeInput(a.el,a.length)})},getFormData:function(){var e=100,a=100;return"en"!==lang&&(e=Number($("#industry").val()),a=Number($("#industrySubmenu").val())),{companyName:$("#company").val(),companyWebsite:$("#officialSite").val()||"无",industryParent:e,industryChildren:a,productType:Number($("#productTypes").val()),applicationName:$("#appName").val(),applicationDesc:$("#appDesc").val(),independentApp:$("#nativeAppName").val(),contactPerson:$("#contact").val(),contactPhone:$("#phone").val(),contactEmail:$("#email").val(),status:0,submitTime:(new Date).getTime(),international:"en"===lang?1:0}},renderI18n:function(e){$.i18n.properties({name:"apply",path:protocol+"//"+location.host+"/public/langs/apply/",mode:"map",language:e,async:!1,debug:!1,callback:function(){main.setHtmlText(),main.setLangVars(),main.renderNavLink(e)}})},setHtmlText:function(){$("[data-i18n-text]").each(function(){var e=$(this),a=e.data("i18n-text");if("en"!==lang)return e.text($.i18n.prop(a));a in keys?e.text(keys[a]):e.text($.i18n.prop(a))})},setLangVars:function(){for(var e in jsVars)"en"===lang&&e in keys?jsVars[e]=keys[e]:jsVars[e]=$.i18n.prop(e);main.config.validateOption.messages={company:{required:jsVars.company_name_required,maxlength:jsVars.company_name_max},industry:{required:jsVars.industry_required},industrySubmenu:{required:jsVars.industry_submenu_required},appName:{required:jsVars.app_name_required,maxlength:jsVars.app_name_max},appDesc:{required:jsVars.app_intro_required,maxlength:jsVars.app_intro_max,minlength:jsVars.app_intro_min},contact:{required:jsVars.contact_required,maxlength:jsVars.contact_max},phone:{minlength:jsVars.contact_tel_min,maxlength:jsVars.contact_tel_max,required:jsVars.contact_tel_required},email:{required:jsVars.contact_mailbox_required,email:jsVars.contact_mailbox_format}}},renderNavLink:function(e){var a=$("#logo"),n=$("#linkDoc"),t=$("#linkContact"),r="./docs/develop/00-model.html",i="./docs/contact.html",o="./docs/en/develop/00-model.html",s="./docs/en/contact.html";"en"===e?(n.attr("href",o),t.attr("href",s),a.attr("src","./images/logo_imoo.png").css("vertical-align","text-bottom")):(n.attr("href",r),t.attr("href",i),a.attr("src","./images/logo_xtc.png").css("vertical-align","middle")),$language.find(`[value="${e}"]`).prop("selected",!0),$("html").attr("lang",e)},controlIndustry(){var a,n=$("#industryContainer");"en"!==lang?main.getResources({key:"industryParent"},function(e){n.show(),a=JSON.parse(e.v),main.initRenderCategory(a,$("#industry"))}):n.hide()}};main.init();